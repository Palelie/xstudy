<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RabbitMQ基础 | Xstudy</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/xstudy/img/logo1.ico">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?b17d02e4e0a8eeddf8b55aa8c0f1e764";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
  </script>
    <script language="javascript" type="text/javascript" src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="/xstudy/js/MouseClickEffect.js"></script>
    <script language="javascript" type="text/javascript" src="/xstudy/js/enhanceAPP.js"></script>
    <meta name="description" content="my study record">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="baidu-site-verification" content="code-bGotmcnXsO">
    
    <link rel="preload" href="/xstudy/assets/css/0.styles.d9f88a7e.css" as="style"><link rel="preload" href="/xstudy/assets/js/app.3d6c3b03.js" as="script"><link rel="preload" href="/xstudy/assets/js/19.64802264.js" as="script"><link rel="preload" href="/xstudy/assets/js/1.09d9e8ff.js" as="script"><link rel="preload" href="/xstudy/assets/js/21.389d7d4e.js" as="script"><link rel="prefetch" href="/xstudy/assets/js/10.9e505c78.js"><link rel="prefetch" href="/xstudy/assets/js/100.065dabe9.js"><link rel="prefetch" href="/xstudy/assets/js/101.57752f52.js"><link rel="prefetch" href="/xstudy/assets/js/102.3ec8fed4.js"><link rel="prefetch" href="/xstudy/assets/js/103.7f060987.js"><link rel="prefetch" href="/xstudy/assets/js/104.9dd47d3f.js"><link rel="prefetch" href="/xstudy/assets/js/105.4714601f.js"><link rel="prefetch" href="/xstudy/assets/js/106.33219791.js"><link rel="prefetch" href="/xstudy/assets/js/107.b091b3b9.js"><link rel="prefetch" href="/xstudy/assets/js/108.b8d5655f.js"><link rel="prefetch" href="/xstudy/assets/js/109.8c440b71.js"><link rel="prefetch" href="/xstudy/assets/js/11.7aaf4552.js"><link rel="prefetch" href="/xstudy/assets/js/110.6a81c441.js"><link rel="prefetch" href="/xstudy/assets/js/111.3326509f.js"><link rel="prefetch" href="/xstudy/assets/js/112.0d27a1a2.js"><link rel="prefetch" href="/xstudy/assets/js/113.38774043.js"><link rel="prefetch" href="/xstudy/assets/js/114.b733495d.js"><link rel="prefetch" href="/xstudy/assets/js/115.1aa4eb46.js"><link rel="prefetch" href="/xstudy/assets/js/116.9eb44980.js"><link rel="prefetch" href="/xstudy/assets/js/117.62f8b73e.js"><link rel="prefetch" href="/xstudy/assets/js/118.0c8efeba.js"><link rel="prefetch" href="/xstudy/assets/js/119.50712dbe.js"><link rel="prefetch" href="/xstudy/assets/js/12.4dfbae75.js"><link rel="prefetch" href="/xstudy/assets/js/120.a89dc5ab.js"><link rel="prefetch" href="/xstudy/assets/js/121.a1bf37f0.js"><link rel="prefetch" href="/xstudy/assets/js/122.eb894b94.js"><link rel="prefetch" href="/xstudy/assets/js/123.c7c6732d.js"><link rel="prefetch" href="/xstudy/assets/js/124.e7b8c439.js"><link rel="prefetch" href="/xstudy/assets/js/125.6635c3ed.js"><link rel="prefetch" href="/xstudy/assets/js/126.d9699570.js"><link rel="prefetch" href="/xstudy/assets/js/127.88e2af70.js"><link rel="prefetch" href="/xstudy/assets/js/128.f201ee6a.js"><link rel="prefetch" href="/xstudy/assets/js/129.5694996d.js"><link rel="prefetch" href="/xstudy/assets/js/13.73d71fdc.js"><link rel="prefetch" href="/xstudy/assets/js/130.f3b34ef8.js"><link rel="prefetch" href="/xstudy/assets/js/131.86f3482e.js"><link rel="prefetch" href="/xstudy/assets/js/132.0f2538d4.js"><link rel="prefetch" href="/xstudy/assets/js/133.af44239a.js"><link rel="prefetch" href="/xstudy/assets/js/134.8e313b62.js"><link rel="prefetch" href="/xstudy/assets/js/135.c9b3e3a8.js"><link rel="prefetch" href="/xstudy/assets/js/136.1101692e.js"><link rel="prefetch" href="/xstudy/assets/js/137.ca5e68ba.js"><link rel="prefetch" href="/xstudy/assets/js/138.4d17bbd8.js"><link rel="prefetch" href="/xstudy/assets/js/139.5605035c.js"><link rel="prefetch" href="/xstudy/assets/js/14.e8a123ad.js"><link rel="prefetch" href="/xstudy/assets/js/140.6ead4839.js"><link rel="prefetch" href="/xstudy/assets/js/141.a0ad2973.js"><link rel="prefetch" href="/xstudy/assets/js/142.e45d497c.js"><link rel="prefetch" href="/xstudy/assets/js/143.e03322af.js"><link rel="prefetch" href="/xstudy/assets/js/144.7ce4488b.js"><link rel="prefetch" href="/xstudy/assets/js/145.597ccc38.js"><link rel="prefetch" href="/xstudy/assets/js/146.25b7c7aa.js"><link rel="prefetch" href="/xstudy/assets/js/147.19f2ea49.js"><link rel="prefetch" href="/xstudy/assets/js/148.aa2a8314.js"><link rel="prefetch" href="/xstudy/assets/js/149.8ba299bb.js"><link rel="prefetch" href="/xstudy/assets/js/15.c41aa653.js"><link rel="prefetch" href="/xstudy/assets/js/150.06d588a8.js"><link rel="prefetch" href="/xstudy/assets/js/151.409eaf70.js"><link rel="prefetch" href="/xstudy/assets/js/152.907b336d.js"><link rel="prefetch" href="/xstudy/assets/js/153.4a0d59ae.js"><link rel="prefetch" href="/xstudy/assets/js/154.81dffa5e.js"><link rel="prefetch" href="/xstudy/assets/js/155.f466274f.js"><link rel="prefetch" href="/xstudy/assets/js/156.3e337c60.js"><link rel="prefetch" href="/xstudy/assets/js/157.52d5423e.js"><link rel="prefetch" href="/xstudy/assets/js/158.0bf9a908.js"><link rel="prefetch" href="/xstudy/assets/js/159.138024e6.js"><link rel="prefetch" href="/xstudy/assets/js/16.dc1514b4.js"><link rel="prefetch" href="/xstudy/assets/js/160.dce4d5d9.js"><link rel="prefetch" href="/xstudy/assets/js/161.4d73e91a.js"><link rel="prefetch" href="/xstudy/assets/js/162.2c0abd94.js"><link rel="prefetch" href="/xstudy/assets/js/163.15fff109.js"><link rel="prefetch" href="/xstudy/assets/js/164.017d4274.js"><link rel="prefetch" href="/xstudy/assets/js/165.b3069502.js"><link rel="prefetch" href="/xstudy/assets/js/166.eae77c2f.js"><link rel="prefetch" href="/xstudy/assets/js/167.fbb610cc.js"><link rel="prefetch" href="/xstudy/assets/js/168.e08e8d04.js"><link rel="prefetch" href="/xstudy/assets/js/169.300d5878.js"><link rel="prefetch" href="/xstudy/assets/js/17.6d036c62.js"><link rel="prefetch" href="/xstudy/assets/js/170.bd3f045b.js"><link rel="prefetch" href="/xstudy/assets/js/171.fd8361eb.js"><link rel="prefetch" href="/xstudy/assets/js/172.2544084e.js"><link rel="prefetch" href="/xstudy/assets/js/173.1a4e39ce.js"><link rel="prefetch" href="/xstudy/assets/js/174.a0f0cf50.js"><link rel="prefetch" href="/xstudy/assets/js/175.17468be0.js"><link rel="prefetch" href="/xstudy/assets/js/18.2642cef9.js"><link rel="prefetch" href="/xstudy/assets/js/20.b7ed91a2.js"><link rel="prefetch" href="/xstudy/assets/js/22.926d3140.js"><link rel="prefetch" href="/xstudy/assets/js/23.2d8a8692.js"><link rel="prefetch" href="/xstudy/assets/js/24.8e4d89b3.js"><link rel="prefetch" href="/xstudy/assets/js/25.99f3a3d1.js"><link rel="prefetch" href="/xstudy/assets/js/26.18e9c4b2.js"><link rel="prefetch" href="/xstudy/assets/js/27.6526c1ed.js"><link rel="prefetch" href="/xstudy/assets/js/28.4322ec4a.js"><link rel="prefetch" href="/xstudy/assets/js/29.60f029d5.js"><link rel="prefetch" href="/xstudy/assets/js/3.4370b068.js"><link rel="prefetch" href="/xstudy/assets/js/30.3e1bc698.js"><link rel="prefetch" href="/xstudy/assets/js/31.b44cf23d.js"><link rel="prefetch" href="/xstudy/assets/js/32.16f7d057.js"><link rel="prefetch" href="/xstudy/assets/js/33.868fc9fc.js"><link rel="prefetch" href="/xstudy/assets/js/34.90a94613.js"><link rel="prefetch" href="/xstudy/assets/js/35.9f008119.js"><link rel="prefetch" href="/xstudy/assets/js/36.19a72ee9.js"><link rel="prefetch" href="/xstudy/assets/js/37.a29485d4.js"><link rel="prefetch" href="/xstudy/assets/js/38.9e503ccf.js"><link rel="prefetch" href="/xstudy/assets/js/39.f882199a.js"><link rel="prefetch" href="/xstudy/assets/js/4.df1fb657.js"><link rel="prefetch" href="/xstudy/assets/js/40.bb38eb7e.js"><link rel="prefetch" href="/xstudy/assets/js/41.0a0e8892.js"><link rel="prefetch" href="/xstudy/assets/js/42.ee7c55d5.js"><link rel="prefetch" href="/xstudy/assets/js/43.ec85f03b.js"><link rel="prefetch" href="/xstudy/assets/js/44.cf439fbd.js"><link rel="prefetch" href="/xstudy/assets/js/45.bbdfa21c.js"><link rel="prefetch" href="/xstudy/assets/js/46.5b3a05f8.js"><link rel="prefetch" href="/xstudy/assets/js/47.2c6b5b7a.js"><link rel="prefetch" href="/xstudy/assets/js/48.e2d99bca.js"><link rel="prefetch" href="/xstudy/assets/js/49.da575daa.js"><link rel="prefetch" href="/xstudy/assets/js/5.f5f9fcd7.js"><link rel="prefetch" href="/xstudy/assets/js/50.5dc0b092.js"><link rel="prefetch" href="/xstudy/assets/js/51.5090323d.js"><link rel="prefetch" href="/xstudy/assets/js/52.f17a6c74.js"><link rel="prefetch" href="/xstudy/assets/js/53.7e407da9.js"><link rel="prefetch" href="/xstudy/assets/js/54.eeba64ae.js"><link rel="prefetch" href="/xstudy/assets/js/55.bf276748.js"><link rel="prefetch" href="/xstudy/assets/js/56.2f503b71.js"><link rel="prefetch" href="/xstudy/assets/js/57.2eb18d4a.js"><link rel="prefetch" href="/xstudy/assets/js/58.8fc4a91e.js"><link rel="prefetch" href="/xstudy/assets/js/59.43013c02.js"><link rel="prefetch" href="/xstudy/assets/js/6.acca9de8.js"><link rel="prefetch" href="/xstudy/assets/js/60.c281bd3b.js"><link rel="prefetch" href="/xstudy/assets/js/61.09ca19a1.js"><link rel="prefetch" href="/xstudy/assets/js/62.2d3dcbcd.js"><link rel="prefetch" href="/xstudy/assets/js/63.8c6a84a8.js"><link rel="prefetch" href="/xstudy/assets/js/64.a6b74307.js"><link rel="prefetch" href="/xstudy/assets/js/65.e984f895.js"><link rel="prefetch" href="/xstudy/assets/js/66.70b3dace.js"><link rel="prefetch" href="/xstudy/assets/js/67.4f317baf.js"><link rel="prefetch" href="/xstudy/assets/js/68.82b63769.js"><link rel="prefetch" href="/xstudy/assets/js/69.7a5a14ed.js"><link rel="prefetch" href="/xstudy/assets/js/7.5fe409d5.js"><link rel="prefetch" href="/xstudy/assets/js/70.2b4322f2.js"><link rel="prefetch" href="/xstudy/assets/js/71.3b479114.js"><link rel="prefetch" href="/xstudy/assets/js/72.60df85f8.js"><link rel="prefetch" href="/xstudy/assets/js/73.ccc8041f.js"><link rel="prefetch" href="/xstudy/assets/js/74.bd916aee.js"><link rel="prefetch" href="/xstudy/assets/js/75.02a42354.js"><link rel="prefetch" href="/xstudy/assets/js/76.afa4a7d0.js"><link rel="prefetch" href="/xstudy/assets/js/77.4dcb8d58.js"><link rel="prefetch" href="/xstudy/assets/js/78.f14c7eaf.js"><link rel="prefetch" href="/xstudy/assets/js/79.941a2930.js"><link rel="prefetch" href="/xstudy/assets/js/8.ce9a12cc.js"><link rel="prefetch" href="/xstudy/assets/js/80.11affd3b.js"><link rel="prefetch" href="/xstudy/assets/js/81.6b276616.js"><link rel="prefetch" href="/xstudy/assets/js/82.9a2c356d.js"><link rel="prefetch" href="/xstudy/assets/js/83.fb20d08e.js"><link rel="prefetch" href="/xstudy/assets/js/84.00568eed.js"><link rel="prefetch" href="/xstudy/assets/js/85.9043e674.js"><link rel="prefetch" href="/xstudy/assets/js/86.7f2eeacd.js"><link rel="prefetch" href="/xstudy/assets/js/87.565a3ce4.js"><link rel="prefetch" href="/xstudy/assets/js/88.b4e6e8db.js"><link rel="prefetch" href="/xstudy/assets/js/89.fa5ebb43.js"><link rel="prefetch" href="/xstudy/assets/js/9.89838fa8.js"><link rel="prefetch" href="/xstudy/assets/js/90.26b66eba.js"><link rel="prefetch" href="/xstudy/assets/js/91.bbf6ddb0.js"><link rel="prefetch" href="/xstudy/assets/js/92.ec8f6228.js"><link rel="prefetch" href="/xstudy/assets/js/93.605d953e.js"><link rel="prefetch" href="/xstudy/assets/js/94.9efdb0ae.js"><link rel="prefetch" href="/xstudy/assets/js/95.22fdddcb.js"><link rel="prefetch" href="/xstudy/assets/js/96.280d495a.js"><link rel="prefetch" href="/xstudy/assets/js/97.ed5489b5.js"><link rel="prefetch" href="/xstudy/assets/js/98.754d578b.js"><link rel="prefetch" href="/xstudy/assets/js/99.161fe63d.js">
    <link rel="stylesheet" href="/xstudy/assets/css/0.styles.d9f88a7e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Xstudy</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>my study record</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>默</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2023
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/xstudy/" class="home-link router-link-active"><img src="/xstudy/img/logo.jpg" alt="Xstudy" class="logo"> <span class="site-name">Xstudy</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/xstudy/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      摸鱼心得
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xstudy/categories/数据结构/" class="nav-link"><i class="undefined"></i>
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/xstudy/categories/框架/" class="nav-link"><i class="undefined"></i>
  框架
</a></li><li class="dropdown-item"><!----> <a href="/xstudy/categories/java/" class="nav-link"><i class="undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/xstudy/categories/中间件/" class="nav-link"><i class="undefined"></i>
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/xstudy/categories/算法/" class="nav-link"><i class="undefined"></i>
  算法
</a></li></ul></div></div><div class="nav-item"><a href="/xstudy/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/xstudy/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  日志
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      开源
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Palelie/xstudy" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/Palelies/xstudy" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/xstudy/img/logo.jpg" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    默
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>165</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>25</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/xstudy/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      摸鱼心得
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xstudy/categories/数据结构/" class="nav-link"><i class="undefined"></i>
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/xstudy/categories/框架/" class="nav-link"><i class="undefined"></i>
  框架
</a></li><li class="dropdown-item"><!----> <a href="/xstudy/categories/java/" class="nav-link"><i class="undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/xstudy/categories/中间件/" class="nav-link"><i class="undefined"></i>
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/xstudy/categories/算法/" class="nav-link"><i class="undefined"></i>
  算法
</a></li></ul></div></div><div class="nav-item"><a href="/xstudy/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/xstudy/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  日志
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      开源
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Palelie/xstudy" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/Palelies/xstudy" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>中间件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xstudy/blogs/middleware/xuyan.html" class="sidebar-link">序言</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xstudy/blogs/middleware/mysql/MySQL.html" class="sidebar-link">Mysql</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>Redis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xstudy/blogs/middleware/redis/quick_start.html" class="sidebar-link">Redis基础</a></li><li><a href="/xstudy/blogs/middleware/redis/redis_senior.html" class="sidebar-link">Redis高级</a></li><li><a href="/xstudy/blogs/middleware/redis/distributed_caching.html" class="sidebar-link">Redis分布式缓存</a></li><li><a href="/xstudy/blogs/middleware/redis/multi_cache.html" class="sidebar-link">多级缓存</a></li><li><a href="/xstudy/blogs/middleware/redis/principle.html" class="sidebar-link">Redis原理</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>消息队列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html" aria-current="page" class="active sidebar-link">RabbitMQ基础</a></li><li><a href="/xstudy/blogs/middleware/MQ/RabbitMQ_senior.html" class="sidebar-link">RabbitMQ高级</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>分布式搜索引擎</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xstudy/blogs/middleware/elasticsearch/elasticsearch01.html" class="sidebar-link">Elasticsearch01</a></li><li><a href="/xstudy/blogs/middleware/elasticsearch/elasticsearch02.html" class="sidebar-link">Elasticsearch02</a></li><li><a href="/xstudy/blogs/middleware/elasticsearch/elasticsearch03.html" class="sidebar-link">Elasticsearch03</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>容器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xstudy/blogs/middleware/docker/Docker.html" class="sidebar-link">Docker</a></li></ul></section></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>RabbitMQ基础</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>默</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2023
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">RabbitMQ基础</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>默</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>10/23/2022</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>RabbitMQ</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="rabbitmq基础"><a href="#rabbitmq基础" class="header-anchor">#</a> RabbitMQ基础</h1> <h1 id="_1-初识mq"><a href="#_1-初识mq" class="header-anchor">#</a> 1.初识MQ</h1> <h2 id="_1-1-同步和异步通讯"><a href="#_1-1-同步和异步通讯" class="header-anchor">#</a> 1.1.同步和异步通讯</h2> <p>微服务间通讯有同步和异步两种方式：</p> <p>同步通讯：就像打电话，需要实时响应。</p> <p>异步通讯：就像发邮件，不需要马上回复。</p> <p><img src="/xstudy/assets/img/image-20210717161939695.75c5450a.png" alt="image-20210717161939695"></p> <p>两种方式各有优劣，打电话可以立即得到响应，但是你却不能跟多个人同时通话。发送邮件可以同时与多个人收发邮件，但是往往响应会有延迟。</p> <h3 id="_1-1-1-同步通讯"><a href="#_1-1-1-同步通讯" class="header-anchor">#</a> 1.1.1.同步通讯</h3> <p>我们之前学习的Feign调用就属于同步方式，虽然调用可以实时得到结果，但存在下面的问题：</p> <p><img src="/xstudy/assets/img/image-20210717162004285.675cd6c8.png" alt="image-20210717162004285"></p> <p>总结：</p> <p>同步调用的优点：</p> <ul><li>时效性较强，可以立即得到结果</li></ul> <p>同步调用的问题：</p> <ul><li>耦合度高</li> <li>性能和吞吐能力下降</li> <li>有额外的资源消耗</li> <li>有级联失败问题</li></ul> <h3 id="_1-1-2-异步通讯"><a href="#_1-1-2-异步通讯" class="header-anchor">#</a> 1.1.2.异步通讯</h3> <p>异步调用则可以避免上述问题：</p> <p>我们以购买商品为例，用户支付后需要调用订单服务完成订单状态修改，调用物流服务，从仓库分配响应的库存并准备发货。</p> <p>在事件模式中，支付服务是事件发布者（publisher），在支付完成后只需要发布一个支付成功的事件（event），事件中带上订单id。</p> <p>订单服务和物流服务是事件订阅者（Consumer），订阅支付成功的事件，监听到事件后完成自己业务即可。</p> <p>为了解除事件发布者与订阅者之间的耦合，两者并不是直接通信，而是有一个中间人（Broker）。发布者发布事件到Broker，不关心谁来订阅事件。订阅者从Broker订阅事件，不关心谁发来的消息。</p> <p><img src="/xstudy/assets/img/image-20210422095356088.2de21ddd.png" alt="image-20210422095356088"></p> <p>Broker 是一个像数据总线一样的东西，所有的服务要接收数据和发送数据都发到这个总线上，这个总线就像协议一样，让服务间的通讯变得标准和可控。</p> <p>好处：</p> <ul><li><p>吞吐量提升：无需等待订阅者处理完成，响应更快速</p></li> <li><p>故障隔离：服务没有直接调用，不存在级联失败问题</p></li> <li><p>调用间没有阻塞，不会造成无效的资源占用</p></li> <li><p>耦合度极低，每个服务都可以灵活插拔，可替换</p></li> <li><p>流量削峰：不管发布事件的流量波动多大，都由Broker接收，订阅者可以按照自己的速度去处理事件</p></li></ul> <p>缺点：</p> <ul><li>架构复杂了，业务没有明显的流程线，不好管理</li> <li>需要依赖于Broker的可靠、安全、性能</li></ul> <p>好在现在开源软件或云平台上 Broker 的软件是非常成熟的，比较常见的一种就是我们今天要学习的MQ技术。</p> <h2 id="_1-2-技术对比"><a href="#_1-2-技术对比" class="header-anchor">#</a> 1.2.技术对比：</h2> <p>MQ，中文是消息队列（MessageQueue），字面来看就是存放消息的队列。也就是事件驱动架构中的Broker。</p> <p>比较常见的MQ实现：</p> <ul><li>ActiveMQ</li> <li>RabbitMQ</li> <li>RocketMQ</li> <li>Kafka</li></ul> <p>几种常见MQ的对比：</p> <table><thead><tr><th></th> <th><strong>RabbitMQ</strong></th> <th><strong>ActiveMQ</strong></th> <th><strong>RocketMQ</strong></th> <th><strong>Kafka</strong></th></tr></thead> <tbody><tr><td>公司/社区</td> <td>Rabbit</td> <td>Apache</td> <td>阿里</td> <td>Apache</td></tr> <tr><td>开发语言</td> <td>Erlang</td> <td>Java</td> <td>Java</td> <td>Scala&amp;Java</td></tr> <tr><td>协议支持</td> <td>AMQP，XMPP，SMTP，STOMP</td> <td>OpenWire,STOMP，REST,XMPP,AMQP</td> <td>自定义协议</td> <td>自定义协议</td></tr> <tr><td>可用性</td> <td>高</td> <td>一般</td> <td>高</td> <td>高</td></tr> <tr><td>单机吞吐量</td> <td>一般</td> <td>差</td> <td>高</td> <td>非常高</td></tr> <tr><td>消息延迟</td> <td>微秒级</td> <td>毫秒级</td> <td>毫秒级</td> <td>毫秒以内</td></tr> <tr><td>消息可靠性</td> <td>高</td> <td>一般</td> <td>高</td> <td>一般</td></tr></tbody></table> <p>追求可用性：Kafka、 RocketMQ 、RabbitMQ</p> <p>追求可靠性：RabbitMQ、RocketMQ</p> <p>追求吞吐能力：RocketMQ、Kafka</p> <p>追求消息低延迟：RabbitMQ、Kafka</p> <h1 id="_2-快速入门"><a href="#_2-快速入门" class="header-anchor">#</a> 2.快速入门</h1> <h2 id="_2-1-安装rabbitmq"><a href="#_2-1-安装rabbitmq" class="header-anchor">#</a> 2.1.安装RabbitMQ</h2> <p>安装RabbitMQ，参考课前资料：</p> <p><img src="data:image/png;base64,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" alt="image-20210717162628635"></p> <p>MQ的基本结构：</p> <p><img src="/xstudy/assets/img/image-20210717162752376.b00101bd.png" alt="image-20210717162752376"></p> <p>RabbitMQ中的一些角色：</p> <ul><li>publisher：生产者</li> <li>consumer：消费者</li> <li>exchange个：交换机，负责消息路由</li> <li>queue：队列，存储消息</li> <li>virtualHost：虚拟主机，隔离不同租户的exchange、queue、消息的隔离</li></ul> <h2 id="_2-2-rabbitmq消息模型"><a href="#_2-2-rabbitmq消息模型" class="header-anchor">#</a> 2.2.RabbitMQ消息模型</h2> <p>RabbitMQ官方提供了5个不同的Demo示例，对应了不同的消息模型：</p> <p><img src="/xstudy/assets/img/image-20210717163332646.c1e7fcc8.png" alt="image-20210717163332646"></p> <h2 id="_2-3-导入demo工程"><a href="#_2-3-导入demo工程" class="header-anchor">#</a> 2.3.导入Demo工程</h2> <p>课前资料提供了一个Demo工程，mq-demo:</p> <p><img src="/xstudy/assets/img/image-20210717163253264.6cd34c58.png" alt="image-20210717163253264"></p> <p>导入后可以看到结构如下：</p> <p><img src="/xstudy/assets/img/image-20210717163604330.f07729be.png" alt="image-20210717163604330"></p> <p>包括三部分：</p> <ul><li>mq-demo：父工程，管理项目依赖</li> <li>publisher：消息的发送者</li> <li>consumer：消息的消费者</li></ul> <h2 id="_2-4-入门案例"><a href="#_2-4-入门案例" class="header-anchor">#</a> 2.4.入门案例</h2> <p>简单队列模式的模型图：</p> <p><img src="/xstudy/assets/img/image-20210717163434647.53ccff8c.png" alt="image-20210717163434647"></p> <p>官方的HelloWorld是基于最基础的消息队列模型来实现的，只包括三个角色：</p> <ul><li>publisher：消息发布者，将消息发送到队列queue</li> <li>queue：消息队列，负责接受并缓存消息</li> <li>consumer：订阅队列，处理队列中的消息</li></ul> <h3 id="_2-4-1-publisher实现"><a href="#_2-4-1-publisher实现" class="header-anchor">#</a> 2.4.1.publisher实现</h3> <p>思路：</p> <ul><li>建立连接</li> <li>创建Channel</li> <li>声明队列</li> <li>发送消息</li> <li>关闭连接和channel</li></ul> <p>代码实现：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mq<span class="token punctuation">.</span>helloworld</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Connection</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeoutException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PublisherTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.建立连接</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1.1.设置连接参数，分别是：主机名、端口号、vhost、用户名、密码</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.150.101&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;itcast&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;123321&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1.2.建立连接</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2.创建通道Channel</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3.创建队列</span>
        <span class="token class-name">String</span> queueName <span class="token operator">=</span> <span class="token string">&quot;simple.queue&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4.发送消息</span>
        <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">&quot;hello, rabbitmq!&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> queueName<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;发送消息成功：【&quot;</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">&quot;】&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 5.关闭通道和连接</span>
        channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="_2-4-2-consumer实现"><a href="#_2-4-2-consumer实现" class="header-anchor">#</a> 2.4.2.consumer实现</h3> <p>代码思路：</p> <ul><li>建立连接</li> <li>创建Channel</li> <li>声明队列</li> <li>订阅消息</li></ul> <p>代码实现：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mq<span class="token punctuation">.</span>helloworld</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeoutException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.建立连接</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1.1.设置连接参数，分别是：主机名、端口号、vhost、用户名、密码</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.150.101&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;itcast&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;123321&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1.2.建立连接</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2.创建通道Channel</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3.创建队列</span>
        <span class="token class-name">String</span> queueName <span class="token operator">=</span> <span class="token string">&quot;simple.queue&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4.订阅消息</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span>
                                       <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token comment">// 5.处理消息</span>
                <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;接收到消息：【&quot;</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">&quot;】&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;等待接收消息。。。。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h2 id="_2-5-总结"><a href="#_2-5-总结" class="header-anchor">#</a> 2.5.总结</h2> <p>基本消息队列的消息发送流程：</p> <ol><li><p>建立connection</p></li> <li><p>创建channel</p></li> <li><p>利用channel声明队列</p></li> <li><p>利用channel向队列发送消息</p></li></ol> <p>基本消息队列的消息接收流程：</p> <ol><li><p>建立connection</p></li> <li><p>创建channel</p></li> <li><p>利用channel声明队列</p></li> <li><p>定义consumer的消费行为handleDelivery()</p></li> <li><p>利用channel将消费者与队列绑定</p></li></ol> <h1 id="_3-springamqp"><a href="#_3-springamqp" class="header-anchor">#</a> 3.SpringAMQP</h1> <p>SpringAMQP是基于RabbitMQ封装的一套模板，并且还利用SpringBoot对其实现了自动装配，使用起来非常方便。</p> <p>SpringAmqp的官方地址：https://spring.io/projects/spring-amqp</p> <p><img src="/xstudy/assets/img/image-20210717164024967.695b4b8d.png" alt="image-20210717164024967"></p> <p><img src="/xstudy/assets/img/image-20210717164038678.7e69fbeb.png" alt="image-20210717164038678"></p> <p>SpringAMQP提供了三个功能：</p> <ul><li>自动声明队列、交换机及其绑定关系</li> <li>基于注解的监听器模式，异步接收消息</li> <li>封装了RabbitTemplate工具，用于发送消息</li></ul> <h2 id="_3-1-basic-queue-简单队列模型"><a href="#_3-1-basic-queue-简单队列模型" class="header-anchor">#</a> 3.1.Basic Queue 简单队列模型</h2> <p>在父工程mq-demo中引入依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--AMQP依赖，包含RabbitMQ--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-1-1-消息发送"><a href="#_3-1-1-消息发送" class="header-anchor">#</a> 3.1.1.消息发送</h3> <p>首先配置MQ地址，在publisher服务的application.yml中添加配置：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.150.101 <span class="token comment"># 主机名</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span> <span class="token comment"># 端口</span>
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> / <span class="token comment"># 虚拟主机</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> itcast <span class="token comment"># 用户名</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123321</span> <span class="token comment"># 密码</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>然后在publisher服务中编写测试类SpringAmqpTest，并利用RabbitTemplate实现消息发送：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mq<span class="token punctuation">.</span>spring</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringRunner</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringAmqpTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSimpleQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 队列名称</span>
        <span class="token class-name">String</span> queueName <span class="token operator">=</span> <span class="token string">&quot;simple.queue&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 消息</span>
        <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">&quot;hello, spring amqp!&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 发送消息</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="_3-1-2-消息接收"><a href="#_3-1-2-消息接收" class="header-anchor">#</a> 3.1.2.消息接收</h3> <p>首先配置MQ地址，在consumer服务的application.yml中添加配置：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.150.101 <span class="token comment"># 主机名</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span> <span class="token comment"># 端口</span>
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> / <span class="token comment"># 虚拟主机</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> itcast <span class="token comment"># 用户名</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123321</span> <span class="token comment"># 密码</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>然后在consumer服务的<code>cn.itcast.mq.listener</code>包中新建一个类SpringRabbitListener，代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mq<span class="token punctuation">.</span>listener</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringRabbitListener</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;simple.queue&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenSimpleQueueMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;spring 消费者接收到消息：【&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;】&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_3-1-3-测试"><a href="#_3-1-3-测试" class="header-anchor">#</a> 3.1.3.测试</h3> <p>启动consumer服务，然后在publisher服务中运行测试代码，发送MQ消息</p> <h2 id="_3-2-workqueue"><a href="#_3-2-workqueue" class="header-anchor">#</a> 3.2.WorkQueue</h2> <p>Work queues，也被称为（Task queues），任务模型。简单来说就是<strong>让多个消费者绑定到一个队列，共同消费队列中的消息</strong>。</p> <p><img src="/xstudy/assets/img/image-20210717164238910.aea99599.png" alt="image-20210717164238910"></p> <p>当消息处理比较耗时的时候，可能生产消息的速度会远远大于消息的消费速度。长此以往，消息就会堆积越来越多，无法及时处理。</p> <p>此时就可以使用work 模型，多个消费者共同处理消息处理，速度就能大大提高了。</p> <h3 id="_3-2-1-消息发送"><a href="#_3-2-1-消息发送" class="header-anchor">#</a> 3.2.1.消息发送</h3> <p>这次我们循环发送，模拟大量消息堆积现象。</p> <p>在publisher服务中的SpringAmqpTest类中添加一个测试方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * workQueue
     * 向队列中不停发送消息，模拟消息堆积。
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testWorkQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 队列名称</span>
    <span class="token class-name">String</span> queueName <span class="token operator">=</span> <span class="token string">&quot;simple.queue&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 消息</span>
    <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">&quot;hello, message_&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 发送消息</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> message <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_3-2-2-消息接收"><a href="#_3-2-2-消息接收" class="header-anchor">#</a> 3.2.2.消息接收</h3> <p>要模拟多个消费者绑定同一个队列，我们在consumer服务的SpringRabbitListener中添加2个新的方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;simple.queue&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenWorkQueue1</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者1接收到消息：【&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;】&quot;</span> <span class="token operator">+</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;simple.queue&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenWorkQueue2</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者2........接收到消息：【&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;】&quot;</span> <span class="token operator">+</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>注意到这个消费者sleep了1000秒，模拟任务耗时。</p> <h3 id="_3-2-3-测试"><a href="#_3-2-3-测试" class="header-anchor">#</a> 3.2.3.测试</h3> <p>启动ConsumerApplication后，在执行publisher服务中刚刚编写的发送测试方法testWorkQueue。</p> <p>可以看到消费者1很快完成了自己的25条消息。消费者2却在缓慢的处理自己的25条消息。</p> <p>也就是说消息是平均分配给每个消费者，并没有考虑到消费者的处理能力。这样显然是有问题的。</p> <h3 id="_3-2-4-能者多劳"><a href="#_3-2-4-能者多劳" class="header-anchor">#</a> 3.2.4.能者多劳</h3> <p>在spring中有一个简单的配置，可以解决这个问题。我们修改consumer服务的application.yml文件，添加配置：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">listener</span><span class="token punctuation">:</span>
      <span class="token key atrule">simple</span><span class="token punctuation">:</span>
        <span class="token key atrule">prefetch</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># 每次只能获取一条消息，处理完成才能获取下一个消息</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-2-5-总结"><a href="#_3-2-5-总结" class="header-anchor">#</a> 3.2.5.总结</h3> <p>Work模型的使用：</p> <ul><li>多个消费者绑定到一个队列，同一条消息只会被一个消费者处理</li> <li>通过设置prefetch来控制消费者预取的消息数量</li></ul> <h2 id="_3-3-发布-订阅"><a href="#_3-3-发布-订阅" class="header-anchor">#</a> 3.3.发布/订阅</h2> <p>发布订阅的模型如图：</p> <p><img src="/xstudy/assets/img/image-20210717165309625.f97b1e36.png" alt="image-20210717165309625"></p> <p>可以看到，在订阅模型中，多了一个exchange角色，而且过程略有变化：</p> <ul><li>Publisher：生产者，也就是要发送消息的程序，但是不再发送到队列中，而是发给X（交换机）</li> <li>Exchange：交换机，图中的X。一方面，接收生产者发送的消息。另一方面，知道如何处理消息，例如递交给某个特别队列、递交给所有队列、或是将消息丢弃。到底如何操作，取决于Exchange的类型。Exchange有以下3种类型：
<ul><li>Fanout：广播，将消息交给所有绑定到交换机的队列</li> <li>Direct：定向，把消息交给符合指定routing key 的队列</li> <li>Topic：通配符，把消息交给符合routing pattern（路由模式） 的队列</li></ul></li> <li>Consumer：消费者，与以前一样，订阅队列，没有变化</li> <li>Queue：消息队列也与以前一样，接收消息、缓存消息。</li></ul> <p><strong>Exchange（交换机）只负责转发消息，不具备存储消息的能力</strong>，因此如果没有任何队列与Exchange绑定，或者没有符合路由规则的队列，那么消息会丢失！</p> <h2 id="_3-4-fanout"><a href="#_3-4-fanout" class="header-anchor">#</a> 3.4.Fanout</h2> <p>Fanout，英文翻译是扇出，我觉得在MQ中叫广播更合适。</p> <p><img src="/xstudy/assets/img/image-20210717165438225.dc1debf8.png" alt="image-20210717165438225"></p> <p>在广播模式下，消息发送流程是这样的：</p> <ul><li>1）  可以有多个队列</li> <li>2）  每个队列都要绑定到Exchange（交换机）</li> <li>3）  生产者发送的消息，只能发送到交换机，交换机来决定要发给哪个队列，生产者无法决定</li> <li>4）  交换机把消息发送给绑定过的所有队列</li> <li>5）  订阅队列的消费者都能拿到消息</li></ul> <p>我们的计划是这样的：</p> <ul><li>创建一个交换机 itcast.fanout，类型是Fanout</li> <li>创建两个队列fanout.queue1和fanout.queue2，绑定到交换机itcast.fanout</li></ul> <p><img src="/xstudy/assets/img/image-20210717165509466.41e56e08.png" alt="image-20210717165509466"></p> <h3 id="_3-4-1-声明队列和交换机"><a href="#_3-4-1-声明队列和交换机" class="header-anchor">#</a> 3.4.1.声明队列和交换机</h3> <p>Spring提供了一个接口Exchange，来表示所有不同类型的交换机：</p> <p><img src="/xstudy/assets/img/image-20210717165552676.1a27bc7f.png" alt="image-20210717165552676"></p> <p>在consumer中创建一个类，声明队列和交换机：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mq<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Binding</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">BindingBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">FanoutExchange</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Queue</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FanoutConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 声明交换机
     * @return Fanout类型交换机
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">FanoutExchange</span> <span class="token function">fanoutExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FanoutExchange</span><span class="token punctuation">(</span><span class="token string">&quot;itcast.fanout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 第1个队列
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">fanoutQueue1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;fanout.queue1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 绑定队列和交换机
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">bindingQueue1</span><span class="token punctuation">(</span><span class="token class-name">Queue</span> fanoutQueue1<span class="token punctuation">,</span> <span class="token class-name">FanoutExchange</span> fanoutExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fanoutQueue1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>fanoutExchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 第2个队列
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">fanoutQueue2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;fanout.queue2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 绑定队列和交换机
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">bindingQueue2</span><span class="token punctuation">(</span><span class="token class-name">Queue</span> fanoutQueue2<span class="token punctuation">,</span> <span class="token class-name">FanoutExchange</span> fanoutExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fanoutQueue2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>fanoutExchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h3 id="_3-4-2-消息发送"><a href="#_3-4-2-消息发送" class="header-anchor">#</a> 3.4.2.消息发送</h3> <p>在publisher服务的SpringAmqpTest类中添加测试方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFanoutExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 队列名称</span>
    <span class="token class-name">String</span> exchangeName <span class="token operator">=</span> <span class="token string">&quot;itcast.fanout&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 消息</span>
    <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">&quot;hello, everyone!&quot;</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-4-3-消息接收"><a href="#_3-4-3-消息接收" class="header-anchor">#</a> 3.4.3.消息接收</h3> <p>在consumer服务的SpringRabbitListener中添加两个方法，作为消费者：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;fanout.queue1&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenFanoutQueue1</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者1接收到Fanout消息：【&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;】&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;fanout.queue2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenFanoutQueue2</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者2接收到Fanout消息：【&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;】&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-4-4-总结"><a href="#_3-4-4-总结" class="header-anchor">#</a> 3.4.4.总结</h3> <p>交换机的作用是什么？</p> <ul><li>接收publisher发送的消息</li> <li>将消息按照规则路由到与之绑定的队列</li> <li>不能缓存消息，路由失败，消息丢失</li> <li>FanoutExchange的会将消息路由到每个绑定的队列</li></ul> <p>声明队列、交换机、绑定关系的Bean是什么？</p> <ul><li>Queue</li> <li>FanoutExchange</li> <li>Binding</li></ul> <h2 id="_3-5-direct"><a href="#_3-5-direct" class="header-anchor">#</a> 3.5.Direct</h2> <p>在Fanout模式中，一条消息，会被所有订阅的队列都消费。但是，在某些场景下，我们希望不同的消息被不同的队列消费。这时就要用到Direct类型的Exchange。</p> <p><img src="/xstudy/assets/img/image-20210717170041447.262a1ae2.png" alt="image-20210717170041447"></p> <p>在Direct模型下：</p> <ul><li>队列与交换机的绑定，不能是任意绑定了，而是要指定一个<code>RoutingKey</code>（路由key）</li> <li>消息的发送方在 向 Exchange发送消息时，也必须指定消息的 <code>RoutingKey</code>。</li> <li>Exchange不再把消息交给每一个绑定的队列，而是根据消息的<code>Routing Key</code>进行判断，只有队列的<code>Routingkey</code>与消息的 <code>Routing key</code>完全一致，才会接收到消息</li></ul> <p><strong>案例需求如下</strong>：</p> <ol><li><p>利用@RabbitListener声明Exchange、Queue、RoutingKey</p></li> <li><p>在consumer服务中，编写两个消费者方法，分别监听direct.queue1和direct.queue2</p></li> <li><p>在publisher中编写测试方法，向itcast. direct发送消息</p></li></ol> <p><img src="/xstudy/assets/img/image-20210717170223317.c3f75593.png" alt="image-20210717170223317"></p> <h3 id="_3-5-1-基于注解声明队列和交换机"><a href="#_3-5-1-基于注解声明队列和交换机" class="header-anchor">#</a> 3.5.1.基于注解声明队列和交换机</h3> <p>基于@Bean的方式声明队列和交换机比较麻烦，Spring还提供了基于注解方式来声明。</p> <p>在consumer的SpringRabbitListener中添加两个消费者，同时基于注解来声明队列和交换机：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
    value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;direct.queue1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;itcast.direct&quot;</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">ExchangeTypes</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenDirectQueue1</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者接收到direct.queue1的消息：【&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;】&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
    value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;direct.queue2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;itcast.direct&quot;</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">ExchangeTypes</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;yellow&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenDirectQueue2</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者接收到direct.queue2的消息：【&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;】&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_3-5-2-消息发送"><a href="#_3-5-2-消息发送" class="header-anchor">#</a> 3.5.2.消息发送</h3> <p>在publisher服务的SpringAmqpTest类中添加测试方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSendDirectExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 交换机名称</span>
    <span class="token class-name">String</span> exchangeName <span class="token operator">=</span> <span class="token string">&quot;itcast.direct&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 消息</span>
    <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">&quot;红色警报！日本乱排核废水，导致海洋生物变异，惊现哥斯拉！&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 发送消息</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-5-3-总结"><a href="#_3-5-3-总结" class="header-anchor">#</a> 3.5.3.总结</h3> <p>描述下Direct交换机与Fanout交换机的差异？</p> <ul><li>Fanout交换机将消息路由给每一个与之绑定的队列</li> <li>Direct交换机根据RoutingKey判断路由给哪个队列</li> <li>如果多个队列具有相同的RoutingKey，则与Fanout功能类似</li></ul> <p>基于@RabbitListener注解声明队列和交换机有哪些常见注解？</p> <ul><li>@Queue</li> <li>@Exchange</li></ul> <h2 id="_3-6-topic"><a href="#_3-6-topic" class="header-anchor">#</a> 3.6.Topic</h2> <h3 id="_3-6-1-说明"><a href="#_3-6-1-说明" class="header-anchor">#</a> 3.6.1.说明</h3> <p><code>Topic</code>类型的<code>Exchange</code>与<code>Direct</code>相比，都是可以根据<code>RoutingKey</code>把消息路由到不同的队列。只不过<code>Topic</code>类型<code>Exchange</code>可以让队列在绑定<code>Routing key</code> 的时候使用通配符！</p> <p><code>Routingkey</code> 一般都是有一个或多个单词组成，多个单词之间以”.”分割，例如： <code>item.insert</code></p> <p>通配符规则：</p> <p><code>#</code>：匹配一个或多个词</p> <p><code>*</code>：匹配不多不少恰好1个词</p> <p>举例：</p> <p><code>item.#</code>：能够匹配<code>item.spu.insert</code> 或者 <code>item.spu</code></p> <p><code>item.*</code>：只能匹配<code>item.spu</code></p> <p>​</p> <p>图示：</p> <p><img src="/xstudy/assets/img/image-20210717170705380.f8bc75f6.png" alt="image-20210717170705380"></p> <p>解释：</p> <ul><li>Queue1：绑定的是<code>china.#</code> ，因此凡是以 <code>china.</code>开头的<code>routing key</code> 都会被匹配到。包括china.news和china.weather</li> <li>Queue2：绑定的是<code>#.news</code> ，因此凡是以 <code>.news</code>结尾的 <code>routing key</code> 都会被匹配。包括china.news和japan.news</li></ul> <p>案例需求：</p> <p>实现思路如下：</p> <ol><li><p>并利用@RabbitListener声明Exchange、Queue、RoutingKey</p></li> <li><p>在consumer服务中，编写两个消费者方法，分别监听topic.queue1和topic.queue2</p></li> <li><p>在publisher中编写测试方法，向itcast. topic发送消息</p></li></ol> <p><img src="/xstudy/assets/img/image-20210717170829229.2fa54688.png" alt="image-20210717170829229"></p> <h3 id="_3-6-2-消息发送"><a href="#_3-6-2-消息发送" class="header-anchor">#</a> 3.6.2.消息发送</h3> <p>在publisher服务的SpringAmqpTest类中添加测试方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * topicExchange
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSendTopicExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 交换机名称</span>
    <span class="token class-name">String</span> exchangeName <span class="token operator">=</span> <span class="token string">&quot;itcast.topic&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 消息</span>
    <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">&quot;喜报！孙悟空大战哥斯拉，胜!&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 发送消息</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span> <span class="token string">&quot;china.news&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_3-6-3-消息接收"><a href="#_3-6-3-消息接收" class="header-anchor">#</a> 3.6.3.消息接收</h3> <p>在consumer服务的SpringRabbitListener中添加方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
    value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;topic.queue1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;itcast.topic&quot;</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">ExchangeTypes</span><span class="token punctuation">.</span><span class="token constant">TOPIC</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key <span class="token operator">=</span> <span class="token string">&quot;china.#&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenTopicQueue1</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者接收到topic.queue1的消息：【&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;】&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
    value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;topic.queue2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;itcast.topic&quot;</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">ExchangeTypes</span><span class="token punctuation">.</span><span class="token constant">TOPIC</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key <span class="token operator">=</span> <span class="token string">&quot;#.news&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenTopicQueue2</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者接收到topic.queue2的消息：【&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;】&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_3-6-4-总结"><a href="#_3-6-4-总结" class="header-anchor">#</a> 3.6.4.总结</h3> <p>描述下Direct交换机与Topic交换机的差异？</p> <ul><li>Topic交换机接收的消息RoutingKey必须是多个单词，以 <code>**.**</code> 分割</li> <li>Topic交换机与队列绑定时的bindingKey可以指定通配符</li> <li><code>#</code>：代表0个或多个词</li> <li><code>*</code>：代表1个词</li></ul> <h2 id="_3-7-消息转换器"><a href="#_3-7-消息转换器" class="header-anchor">#</a> 3.7.消息转换器</h2> <p>之前说过，Spring会把你发送的消息序列化为字节发送给MQ，接收消息的时候，还会把字节反序列化为Java对象。</p> <p><img src="/xstudy/assets/img/image-20200525170410401.68eb220c.png" alt="image-20200525170410401"></p> <p>只不过，默认情况下Spring采用的序列化方式是JDK序列化。众所周知，JDK序列化存在下列问题：</p> <ul><li>数据体积过大</li> <li>有安全漏洞</li> <li>可读性差</li></ul> <p>我们来测试一下。</p> <h3 id="_3-7-1-测试默认转换器"><a href="#_3-7-1-测试默认转换器" class="header-anchor">#</a> 3.7.1.测试默认转换器</h3> <p>我们修改消息发送的代码，发送一个Map对象：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSendMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 准备消息</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    msg<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    msg<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 发送消息</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;simple.queue&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>停止consumer服务</p> <p>发送消息后查看控制台：</p> <p><img src="/xstudy/assets/img/image-20210422232835363.38e2d259.png" alt="image-20210422232835363"></p> <h3 id="_3-7-2-配置json转换器"><a href="#_3-7-2-配置json转换器" class="header-anchor">#</a> 3.7.2.配置JSON转换器</h3> <p>显然，JDK序列化方式并不合适。我们希望消息体的体积更小、可读性更高，因此可以使用JSON方式来做序列化和反序列化。</p> <p>在publisher和consumer两个服务中都引入依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.dataformat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-dataformat-xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>配置消息转换器。</p> <p>在启动类中添加一个Bean即可：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">MessageConverter</span> <span class="token function">jsonMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/xstudy/blogs/middleware/redis/principle.html" class="prev">
            Redis原理
          </a></span> <span class="next"><a href="/xstudy/blogs/middleware/MQ/RabbitMQ_senior.html">
            RabbitMQ高级
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_1-1-同步和异步通讯" class="sidebar-link reco-side-_1-1-同步和异步通讯" data-v-70334359>1.1.同步和异步通讯</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_1-1-1-同步通讯" class="sidebar-link reco-side-_1-1-1-同步通讯" data-v-70334359>1.1.1.同步通讯</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_1-1-2-异步通讯" class="sidebar-link reco-side-_1-1-2-异步通讯" data-v-70334359>1.1.2.异步通讯</a></li><li class="level-2" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_1-2-技术对比" class="sidebar-link reco-side-_1-2-技术对比" data-v-70334359>1.2.技术对比：</a></li><li class="level-2" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_2-1-安装rabbitmq" class="sidebar-link reco-side-_2-1-安装rabbitmq" data-v-70334359>2.1.安装RabbitMQ</a></li><li class="level-2" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_2-2-rabbitmq消息模型" class="sidebar-link reco-side-_2-2-rabbitmq消息模型" data-v-70334359>2.2.RabbitMQ消息模型</a></li><li class="level-2" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_2-3-导入demo工程" class="sidebar-link reco-side-_2-3-导入demo工程" data-v-70334359>2.3.导入Demo工程</a></li><li class="level-2" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_2-4-入门案例" class="sidebar-link reco-side-_2-4-入门案例" data-v-70334359>2.4.入门案例</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_2-4-1-publisher实现" class="sidebar-link reco-side-_2-4-1-publisher实现" data-v-70334359>2.4.1.publisher实现</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_2-4-2-consumer实现" class="sidebar-link reco-side-_2-4-2-consumer实现" data-v-70334359>2.4.2.consumer实现</a></li><li class="level-2" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_2-5-总结" class="sidebar-link reco-side-_2-5-总结" data-v-70334359>2.5.总结</a></li><li class="level-2" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-1-basic-queue-简单队列模型" class="sidebar-link reco-side-_3-1-basic-queue-简单队列模型" data-v-70334359>3.1.Basic Queue 简单队列模型</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-1-1-消息发送" class="sidebar-link reco-side-_3-1-1-消息发送" data-v-70334359>3.1.1.消息发送</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-1-2-消息接收" class="sidebar-link reco-side-_3-1-2-消息接收" data-v-70334359>3.1.2.消息接收</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-1-3-测试" class="sidebar-link reco-side-_3-1-3-测试" data-v-70334359>3.1.3.测试</a></li><li class="level-2" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-2-workqueue" class="sidebar-link reco-side-_3-2-workqueue" data-v-70334359>3.2.WorkQueue</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-2-1-消息发送" class="sidebar-link reco-side-_3-2-1-消息发送" data-v-70334359>3.2.1.消息发送</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-2-2-消息接收" class="sidebar-link reco-side-_3-2-2-消息接收" data-v-70334359>3.2.2.消息接收</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-2-3-测试" class="sidebar-link reco-side-_3-2-3-测试" data-v-70334359>3.2.3.测试</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-2-4-能者多劳" class="sidebar-link reco-side-_3-2-4-能者多劳" data-v-70334359>3.2.4.能者多劳</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-2-5-总结" class="sidebar-link reco-side-_3-2-5-总结" data-v-70334359>3.2.5.总结</a></li><li class="level-2" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-3-发布-订阅" class="sidebar-link reco-side-_3-3-发布-订阅" data-v-70334359>3.3.发布/订阅</a></li><li class="level-2" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-4-fanout" class="sidebar-link reco-side-_3-4-fanout" data-v-70334359>3.4.Fanout</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-4-1-声明队列和交换机" class="sidebar-link reco-side-_3-4-1-声明队列和交换机" data-v-70334359>3.4.1.声明队列和交换机</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-4-2-消息发送" class="sidebar-link reco-side-_3-4-2-消息发送" data-v-70334359>3.4.2.消息发送</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-4-3-消息接收" class="sidebar-link reco-side-_3-4-3-消息接收" data-v-70334359>3.4.3.消息接收</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-4-4-总结" class="sidebar-link reco-side-_3-4-4-总结" data-v-70334359>3.4.4.总结</a></li><li class="level-2" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-5-direct" class="sidebar-link reco-side-_3-5-direct" data-v-70334359>3.5.Direct</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-5-1-基于注解声明队列和交换机" class="sidebar-link reco-side-_3-5-1-基于注解声明队列和交换机" data-v-70334359>3.5.1.基于注解声明队列和交换机</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-5-2-消息发送" class="sidebar-link reco-side-_3-5-2-消息发送" data-v-70334359>3.5.2.消息发送</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-5-3-总结" class="sidebar-link reco-side-_3-5-3-总结" data-v-70334359>3.5.3.总结</a></li><li class="level-2" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-6-topic" class="sidebar-link reco-side-_3-6-topic" data-v-70334359>3.6.Topic</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-6-1-说明" class="sidebar-link reco-side-_3-6-1-说明" data-v-70334359>3.6.1.说明</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-6-2-消息发送" class="sidebar-link reco-side-_3-6-2-消息发送" data-v-70334359>3.6.2.消息发送</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-6-3-消息接收" class="sidebar-link reco-side-_3-6-3-消息接收" data-v-70334359>3.6.3.消息接收</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-6-4-总结" class="sidebar-link reco-side-_3-6-4-总结" data-v-70334359>3.6.4.总结</a></li><li class="level-2" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-7-消息转换器" class="sidebar-link reco-side-_3-7-消息转换器" data-v-70334359>3.7.消息转换器</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-7-1-测试默认转换器" class="sidebar-link reco-side-_3-7-1-测试默认转换器" data-v-70334359>3.7.1.测试默认转换器</a></li><li class="level-3" data-v-70334359><a href="/xstudy/blogs/middleware/MQ/RabbitMQ.html#_3-7-2-配置json转换器" class="sidebar-link reco-side-_3-7-2-配置json转换器" data-v-70334359>3.7.2.配置JSON转换器</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:10px;bottom:170px;z-index:999999;display:none;" data-v-5775ee02>
      我是X欢迎你的关注 
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="192" height="281" class="live2d" style="right:65px;bottom:-20px;opacity:0.85;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><canvas id="vuepress-canvas-ribbon"></canvas><div></div><div class="Sakura" data-v-248d85d6><canvas id="canvas_sakura" style="z-index:-1;" data-v-248d85d6></canvas></div></div></div>
    <script src="/xstudy/assets/js/app.3d6c3b03.js" defer></script><script src="/xstudy/assets/js/19.64802264.js" defer></script><script src="/xstudy/assets/js/1.09d9e8ff.js" defer></script><script src="/xstudy/assets/js/21.389d7d4e.js" defer></script>
  </body>
</html>
