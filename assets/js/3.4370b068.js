(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{1e3:function(s,t,a){s.exports=a.p+"assets/img/image-20210716110027064.ec5915b2.png"},1001:function(s,t,a){s.exports=a.p+"assets/img/image-20210716105855951.4633e62b.png"},1002:function(s,t,a){s.exports=a.p+"assets/img/image-20210716105956401.c49c538c.png"},1003:function(s,t,a){s.exports=a.p+"assets/img/image-20210716110225104.8778eae6.png"},1004:function(s,t,a){s.exports=a.p+"assets/img/image-20210716110629796.4dcef0cb.png"},1005:function(s,t,a){s.exports=a.p+"assets/img/image-20210716111012387.522fb88c.png"},1006:function(s,t,a){s.exports=a.p+"assets/img/image-20210716111136699.6d9f686c.png"},1007:function(s,t,a){s.exports=a.p+"assets/img/image-20210716111303701.504cb31e.png"},1008:function(s,t,a){s.exports=a.p+"assets/img/image-20210716111404717.b43e4a6c.png"},1009:function(s,t,a){s.exports=a.p+"assets/img/image-20210716111526480.a0897486.png"},1010:function(s,t,a){s.exports=a.p+"assets/img/image-20210716111658541.d255ad8a.png"},1011:function(s,t){s.exports="data:image/png;base64,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"},1012:function(s,t){s.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAssAAAFeCAYAAABzS1K2AAAOrUlEQVR4nO3dO1IbaReA4dN/zVIkBy5WIK0AOyFySiaFkEw24WSToBAyp0ROjFYgrYAicPde+g/E1eZgDJL69jxVVGEbzGdu887htLqo67oOAADgF/9r+gAAANBWYhkAABJiGQAAEmIZAAASYhkAABJiGQAAEmIZAAASYhkAABJiGQAAEmIZAAASYhkAABJiGQAAEmIZAAASYhkAABJiGQAAEmIZAAASYhkAABJiGQAAEmIZAAASYhkAABJiGQAAEmIZAAASYhkAABJiecuKomj6CAAAbIlY3qK7UBbMAAD9IJYBACAhlrfk52my6TIAQPeJZQAASIjlLcimyKbLAADdJpYBACAhlgEAICGW3+l3qxZWMQAAukssAwBAQiwDAEBCLL/Da1csrGIAAHSTWAYAgIRY3hPTZQCA7hHLbyR+AQD6TywDAEBCLL/BW6fKptEAAN3yV9MH6KK6rp/9/ccxnL0MAADdYbIMAAAJsQwAAAmxDAAACbEMAAAJsQwAAAmxDAAACbEMAAAJsQwAAAmxDAAACbEMAAAJsQwAAAmxDAAACbEMAAAJsQwAAAmxDAAACbEMAAAJsQwAAAmxDAAACbEMAAAJsQwAAAmxDAAAiW7GclVFtVzEYj6P6XQa0/kiqle/6jLm02kURfHwNJ3GfLF89d8BAMAwFHVd100f4lWqRUyPL2O9Xv/6Z5OzKFcnMfrtXzGN8ekzr3//98zianUeh288YlEU98935d0KAECuO5Pl8uYhlCeTmMxmMZv8wetXizi+C+XJWVyVddR1HXVdRnk1i0lExPoiPs2XWz44AABd1Z1YHv8dZVluAne1itX5eRwdvP7Vl/+dxjrifgp9eD+GHsXo8DxWV7PNLy/+jYV9DAAAokuxPBrFaPS7RYvMMr5dbJ6bfPn8/LrG4VFscnkdl9/VMgAAXYrl96h+xHVEREziy+csuA/j6Ha4vL787mI/AAAGEsvlzWYFIw7iwwvD6fHH2yXo9U2UezgWAADtNohYrn5cN30EAAA6aBCx/FqjD39wxSAAAL0nlp91HT8sLQMADJ5YftbLu80AAAyDWAYAgIRYfsSFgAAAPDaIWH64cO/lXeTy5u522B9jvPNTAQDQdoOI5cd357tJH0C5ivvB8sGH5+/yBwDAoAwjlmMcd/cbufi2fP5Fqu9xeTtYnh0d7udYAAC02kBieRQn/9zey/riU0wXP+1iVMuYH59u7vI3OYu/tTIAADGYWI6Iw/O4uu3l9ek4imIa0+k0ptMiivGnuNiUcpx9PbGCAQBARAwpliPi8LyMq7NZbDYy1rFer2N9u3oRk1lclas4UcoAANwq6rqumz5EI6oq7pcxRqOtTJOLorh/fqjvVgCAPhluLO+AWAYA6JdBrWEAAMCfEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkBDLAACQEMsAAJAQywAAkPir6QNAHxRF0djbruu6sbcNAH0nluEFTUbwa733jGIbAHJiGaIbUbwrb/m3C+ynhvz5A33l+xx3xDKDs4uwafKbahOh9ta32fX/+IhigOERy/Re39cU3nu+fQag2ASga8QyvfSnUdb2IN6lt/zbRe/zhvx5BNBXYpleEMf79db3X9cj2+cNwPCIZTrtNfElcNrDxwKArhHLdI5ABgD2RSzTGb+LZIEMAGybWKbVBDIA0CSxTCuJZACgDcQyrfJSJAtkAGDfxDKtIJIBgDYSyzQuC2WRDAA0TSzTGJEMALSdWGbvRDIA0BVimb16LpRFMgDQVmKZvTBNBgC6SCyzc6bJAEBXiWV2xjQZAOg6scxOmCYDAH3wv6YPQP8IZQCgL0yW2aqfQ1kkAwBdJpbZCtNkAKCPrGHwbkIZAOgrscy7CGUAoM+sYfBm9pMBgL4zWeZNhDIAMARimT8mlAGAoRDL/BGhDAAMiVjm1YQyADA0YplXEcoAwBCJZX5LKAMAQyWWeZFQBgCGTCyTEsoAwNCJZZ4llAEAxDLPEMoAABtimSeEMgDAA7HMPaEMAPCUWCYihDIAwHPEMgAAJMQypsoAAAmxPHBCGQAgJ5a5J5QBAJ4SywP281QZAICnxPJAWb8AAPg9sTxAQhkA4HXE8sAJZQCAnFgeGHvKAACvJ5YHxPoFAMCfEcsDJZQBAH5PLA/E46myUAYAeB2xPAD2lAEA3kYsD4ypMgDA64nlnjNVBgB4O7HcYx79AgDgfcTyQAhlAIA/J5Z7yvoFAMD7ieUesn4BALAdYrnnhDIAwNuJ5Z6xfgEAsD1iucdMlQEA3kcs94ipMgDAdonlnjJVBgB4P7HcE6bKAADbJ5Z7yFQZAGA7xHIPPJ4qC2UAgO0Ryx1n/QIAYHfEco+YKgMAbJdY7jBTZQCA3RLLPWGqDACwfWK5o0yVAQB2Tyz3gKkyAMBuiOUOMlUGANgPsdxxpsoAALsjljvGVBkAYH/EcoeZKgMA7JZYBgCAhFjukMcrGKbKAAC7J5YBACAhljvCVBkAYP/EMgAAJMRyB3i4OACAZojljrGCAQCwP2K55UyVAQCaI5Y7xFQZAGC/xHKLmSoDADRLLHeEqTIAwP6JZQAASIjllrKCAQDQPLHcAVYwAACaIZZbyFQZAKAdxHLLmSoDADRHLAMAQEIst8zjFQxTZQCAZollAABIiGUAAEiI5RaxggEA0C5iGQAAEmK5JTy2MgBA+4jlFrKCAQDQDmIZAAASYrkFXNgHANBOYhkAABJiGQAAEmK5YVYwAADaSywDAEBCLAMAQEIsN8gKBgBAu4llAABIiGUAAEiI5YZYwQAAaD+xDAAACbEMAAAJsdwAKxgAAN0glgEAICGWAQAgIZb3zAoGAEB3iGUAAEiIZQAASIjlPXq8ggEAQPuJ5YbYVwYAaD+xDAAACbG8J1YwAAC6Ryw3wAoGAEA3iGUAAEiIZQAASIjlPbCvDADQTWJ5z+wrAwB0h1gGAICEWAYAgIRY3rHH+8pWMAAAukUsAwBAQiwDAEBCLO+Qh4wDAOg2sbwn9pUBALpHLAMAQEIsAwBAQizviH1lAIDuE8t7YF8ZAKCbxPKemDQDAHSPWAYAgIRY3rG6rk2VAQA6SiwDAECi17FcVcuYT6dRFMXD03Qa88Uyqj2dwVQZAKC7irqnD9VQLaYxPl3nLzCZxdXqPA63+DZ/F8Y9fVcDAD1y1zO6ZaOfk+VqEcd3oTw5i6uyjrquo67LKK9mMYmIWF/Ep/myyVMCALTW45/MD1kvJ8vLeRGfLiJichbl6iRGv75AFJsXiLNyFSe/vMDbvPTJ1MN3MwDQQ35S/lQPJ8vL+HaxeW7y5fOvoRwRcXgUs4iIWMfl931tLwMAdN/QJs79i+XqR1xHRMQkvnzORsaHcbSp5Vhfft/5xX5D+z8wAHiLoUVYHwzhY9a/WC5vYrOtfBAfXlivGH+cbJ5Z30S5h2MBAPRZX8O5d7Fc/bhu+ghPmCoDAEPTp2juXSy/1ujDQdNHAFqgr5MQgDbow/fYv5o+QPOu40cVcfjOR8TIPgm6/MkBQ+PrFdrD1yNtMdjJ8oOXd5sBABguk2UAAHaiD9duDTaWt30hYF3XT35k1IdPDhgCX7fQHr4e22EbKzB9+vj1bg3j4cK9zS5ypry5ux32xxhv6W1vbqld9+oTBADgNfraQb2L5cd357tJH0C5ivvB8sGH5+/yBwDsVV9jq8+G8DHrXyzHOO7uN3Lxbfn8i1Tf4/J2sDw7OtzPsYBWGsI3eoBtGtr3zR7G8ihO/rm9l/XFp5guftrFqJYxPz7d3OVvchZ/a2UAgBcNLZAfK+qe/quX8yI+Xdz9ahKTSUTEOtbrh987K1dxYgcDAOCeCy2f6m0sR1SxXPwX/55exPrnP5rM4urr+btvRAIAQL/1OJYfqaq4X8YYjVzQBwDAqwwjlgEA4A16eIEfANAZ1TLm02lMp0UUxdOn6XQei+ULN02APTBZBgCaUy1iOj799fqixyZnUa5OrFHSCJNlAKBBn+OfqzLKsn7y8GR1eRVns9sbJ6xP4/jnh4KFPTFZBgBa6/6hYE2XaYjJMgDQWodHtzcaW99E2exRGCixDAC01/hjbJYxruOHTQwa8FfTBwDYu6qKqvwe37/dxOX1dcTBl/h67se70Erlze3FfwfxwRcpDRDLwDBUi5geX8Z6/dw191/2fhzgdZbfLjbPTD7GuNmjMFDWMIBhKG8eQnkyiclsFncX2gMtVS3i37tW/vLZT39ohFgGhmH8d5RluXlIqtUqVufncXTQ9KGAXBWL49vHX56cxdcTqUwzrGEAwzAamUpBhyzn4zjdlHKcfXVNAc0xWQYAWmU5n24eWzkmMbtahaEyTTJZBgBaoorlfPwklM8Pmz4TQyeWAYAWqGIxfbR6UZoo0w7WMACAZlXLmN+F8mQWV0KZFjFZBgAaUy3ncfzp4v5RL8qVi/loF7EMADSiWs5jvFlQjslZGSvjZFrIGgYA0Iwf1/fPrk/HURTFy0/TRVQNHpdhEssAAJCwhgEANGJ0sor6pOlTwMtMlgEAICGWAQAgIZYBACAhlgEAICGWAQAgUdR1XTd9CAAAaCOTZQAASIhlAABIiGUAAEiIZQAASIhlAABIiGUAAEiIZQAASIhlAABIiGUAAEiIZQAASIhlAABI/B9dL2XCBqYOYgAAAABJRU5ErkJggg=="},1013:function(s,t,a){s.exports=a.p+"assets/img/image-20210716114048918.4be6f815.png"},1014:function(s,t,a){s.exports=a.p+"assets/img/image-20210716114243558.816d8007.png"},1015:function(s,t,a){s.exports=a.p+"assets/img/image-20210716114429361.edb46ebf.png"},1016:function(s,t,a){s.exports=a.p+"assets/img/image-20210716114522935.07c18fe5.png"},1017:function(s,t,a){s.exports=a.p+"assets/img/image-20210716114651137.c09c20a4.png"},1018:function(s,t,a){s.exports=a.p+"assets/img/image-20210716115014663.540c9e4f.png"},1019:function(s,t,a){s.exports=a.p+"assets/img/image-20210716115131463.a37428ed.png"},1020:function(s,t,a){s.exports=a.p+"assets/img/image-20210716115232426.ec471577.png"},1021:function(s,t,a){s.exports=a.p+"assets/img/image-20210716115717523.29c32155.png"},1022:function(s,t,a){s.exports=a.p+"assets/img/image-20210716120033572.b296f793.png"},1023:function(s,t,a){s.exports=a.p+"assets/img/image-20210716120208509.9d38b45b.png"},1024:function(s,t,a){s.exports=a.p+"assets/img/image-20210716120319009.e585c513.png"},1025:function(s,t,a){s.exports=a.p+"assets/img/image-20210716120536714.e3d420d9.png"},1026:function(s,t,a){s.exports=a.p+"assets/img/image-20210716120754527.b2f02281.png"},1027:function(s,t,a){s.exports=a.p+"assets/img/image-20210716120840501.c90b9a92.png"},1028:function(s,t,a){s.exports=a.p+"assets/img/image-20210716121105567.7c23d980.png"},1029:function(s,t,a){s.exports=a.p+"assets/img/image-20210716120900365.1c4f35e0.png"},1030:function(s,t,a){s.exports=a.p+"assets/img/image-20210716121201630.5e81248b.png"},1031:function(s,t,a){s.exports=a.p+"assets/img/image-20210716120919131.9baad862.png"},1032:function(s,t,a){s.exports=a.p+"assets/img/image-20210716121220305.15534ecb.png"},1033:function(s,t,a){s.exports=a.p+"assets/img/image-20210716122403502.6d98ea6e.png"},1034:function(s,t,a){s.exports=a.p+"assets/img/image-20210716123705780.e8de5515.png"},1035:function(s,t,a){s.exports=a.p+"assets/img/image-20210716123036937.7f39d5cd.png"},1036:function(s,t,a){s.exports=a.p+"assets/img/image-20210716123240518.b4f637e2.png"},1037:function(s,t,a){s.exports=a.p+"assets/img/image-20210716123411217.c4d9d0bd.png"},1038:function(s,t,a){s.exports=a.p+"assets/img/image-20210716123831992.effa10e1.png"},1039:function(s,t,a){s.exports=a.p+"assets/img/image-20210716123936844.a4091332.png"},1040:function(s,t,a){s.exports=a.p+"assets/img/image-20210716124229894.19d36764.png"},1041:function(s,t,a){s.exports=a.p+"assets/img/image-20210716124147820.03db0476.png"},1042:function(s,t,a){s.exports=a.p+"assets/img/image-20210716130958518.d7fc1677.png"},1043:function(s,t,a){s.exports=a.p+"assets/img/image-20210716145934347.5abdcae8.png"},1044:function(s,t,a){s.exports=a.p+"assets/img/image-20210716150234787.1050eaaf.png"},1045:function(s,t,a){s.exports=a.p+"assets/img/image-20210716150510956.1428b673.png"},1046:function(s,t,a){s.exports=a.p+"assets/img/image-20210716150605208.38ca01d3.png"},1047:function(s,t,a){s.exports=a.p+"assets/img/image-20210716150740434.02268674.png"},1048:function(s,t,a){s.exports=a.p+"assets/img/image-20210716150911004.b70dd7c5.png"},1049:function(s,t,a){s.exports=a.p+"assets/img/image-20210716151107785.560b40e3.png"},1050:function(s,t,a){s.exports=a.p+"assets/img/image-20210716131430682.bc152107.png"},1051:function(s,t,a){s.exports=a.p+"assets/img/image-20210716131522912.d986a5a4.png"},1052:function(s,t,a){s.exports=a.p+"assets/img/image-20210716151348183.92785eb0.png"},1053:function(s,t,a){s.exports=a.p+"assets/img/image-20210716151538785.9a9184f1.png"},1054:function(s,t,a){s.exports=a.p+"assets/img/image-20210716151722916.f8c8fc58.png"},1055:function(s,t,a){s.exports=a.p+"assets/img/image-20210716151844817.8d590050.png"},1056:function(s,t,a){s.exports=a.p+"assets/img/image-20210716152010750.c6be95de.png"},1057:function(s,t,a){s.exports=a.p+"assets/img/image-20210716152349191.a48dfb97.png"},1058:function(s,t,a){s.exports=a.p+"assets/img/image-20210716153250134.e804f0bf.png"},1059:function(s,t,a){s.exports=a.p+"assets/img/image-20210716153301069.aaedf670.png"},1060:function(s,t,a){s.exports=a.p+"assets/img/image-20210716153348396.0cefed78.png"},1061:function(s,t,a){s.exports=a.p+"assets/img/image-20210716153434095.116bf9a4.png"},1062:function(s,t,a){s.exports=a.p+"assets/img/image-20210716153938887.d3b874e2.png"},1063:function(s,t,a){s.exports=a.p+"assets/img/image-20210716154012736.4bb5a436.png"},1064:function(s,t,a){s.exports=a.p+"assets/img/image-20210716154155238.65f1b8ad.png"},1065:function(s,t,a){s.exports=a.p+"assets/img/image-20210716154215456.6400e8de.png"},1066:function(s,t,a){s.exports=a.p+"assets/img/image-20210716154255466.60db6486.png"},1718:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"微服务保护"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微服务保护"}},[s._v("#")]),s._v(" 微服务保护")]),s._v(" "),n("h1",{attrs:{id:"_1-初识sentinel"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-初识sentinel"}},[s._v("#")]),s._v(" 1.初识Sentinel")]),s._v(" "),n("h2",{attrs:{id:"_1-1-雪崩问题及解决方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-雪崩问题及解决方案"}},[s._v("#")]),s._v(" 1.1.雪崩问题及解决方案")]),s._v(" "),n("h3",{attrs:{id:"_1-1-1-雪崩问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-雪崩问题"}},[s._v("#")]),s._v(" 1.1.1.雪崩问题")]),s._v(" "),n("p",[s._v("微服务中，服务间调用关系错综复杂，一个微服务往往依赖于多个其它微服务。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(967),alt:"1533829099748"}})]),s._v(" "),n("p",[s._v("如图，如果服务提供者I发生了故障，当前的应用的部分业务因为依赖于服务I，因此也会被阻塞。此时，其它不依赖于服务I的业务似乎不受影响。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(968),alt:"1533829198240"}})]),s._v(" "),n("p",[s._v("但是，依赖服务I的业务请求被阻塞，用户不会得到响应，则tomcat的这个线程不会释放，于是越来越多的用户请求到来，越来越多的线程会阻塞：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(969),alt:"1533829307389"}})]),s._v(" "),n("p",[s._v("服务器支持的线程和并发数有限，请求一直阻塞，会导致服务器资源耗尽，从而导致所有其它服务都不可用，那么当前服务也就不可用了。")]),s._v(" "),n("p",[s._v("那么，依赖于当前服务的其它服务随着时间的推移，最终也都会变的不可用，形成级联失败，雪崩就发生了：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(970),alt:"image-20210715172710340"}})]),s._v(" "),n("h3",{attrs:{id:"_1-1-2-超时处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-超时处理"}},[s._v("#")]),s._v(" 1.1.2.超时处理")]),s._v(" "),n("p",[s._v("解决雪崩问题的常见方式有四种：")]),s._v(" "),n("p",[s._v("•超时处理：设定超时时间，请求超过一定时间没有响应就返回错误信息，不会无休止等待")]),s._v(" "),n("p",[n("img",{attrs:{src:a(971),alt:"image-20210715172820438"}})]),s._v(" "),n("h3",{attrs:{id:"_1-1-3-仓壁模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-仓壁模式"}},[s._v("#")]),s._v(" 1.1.3.仓壁模式")]),s._v(" "),n("p",[s._v("方案2：仓壁模式")]),s._v(" "),n("p",[s._v("仓壁模式来源于船舱的设计：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(972),alt:"image-20210715172946352"}})]),s._v(" "),n("p",[s._v("船舱都会被隔板分离为多个独立空间，当船体破损时，只会导致部分空间进入，将故障控制在一定范围内，避免整个船体都被淹没。")]),s._v(" "),n("p",[s._v("于此类似，我们可以限定每个业务能使用的线程数，避免耗尽整个tomcat的资源，因此也叫线程隔离。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(371),alt:"image-20210715173215243"}})]),s._v(" "),n("h3",{attrs:{id:"_1-1-4-断路器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-4-断路器"}},[s._v("#")]),s._v(" 1.1.4.断路器")]),s._v(" "),n("p",[s._v("断路器模式：由"),n("strong",[s._v("断路器")]),s._v("统计业务执行的异常比例，如果超出阈值则会"),n("strong",[s._v("熔断")]),s._v("该业务，拦截访问该业务的一切请求。")]),s._v(" "),n("p",[s._v("断路器会统计访问某个服务的请求数量，异常比例：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(973),alt:"image-20210715173327075"}})]),s._v(" "),n("p",[s._v("当发现访问服务D的请求异常比例过高时，认为服务D有导致雪崩的风险，会拦截访问服务D的一切请求，形成熔断：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(372),alt:"image-20210715173428073"}})]),s._v(" "),n("h3",{attrs:{id:"_1-1-5-限流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-5-限流"}},[s._v("#")]),s._v(" 1.1.5.限流")]),s._v(" "),n("p",[n("strong",[s._v("流量控制")]),s._v("：限制业务访问的QPS，避免服务因流量的突增而故障。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(974),alt:"image-20210715173555158"}})]),s._v(" "),n("h3",{attrs:{id:"_1-1-6-总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-6-总结"}},[s._v("#")]),s._v(" 1.1.6.总结")]),s._v(" "),n("p",[s._v("什么是雪崩问题？")]),s._v(" "),n("ul",[n("li",[s._v("微服务之间相互调用，因为调用链中的一个服务故障，引起整个链路都无法访问的情况。")])]),s._v(" "),n("p",[s._v("可以认为：")]),s._v(" "),n("p",[n("strong",[s._v("限流")]),s._v("是对服务的保护，避免因瞬间高并发流量而导致服务故障，进而避免雪崩。是一种"),n("strong",[s._v("预防")]),s._v("措施。")]),s._v(" "),n("p",[n("strong",[s._v("超时处理、线程隔离、降级熔断")]),s._v("是在部分服务故障时，将故障控制在一定范围，避免雪崩。是一种"),n("strong",[s._v("补救")]),s._v("措施。")]),s._v(" "),n("h2",{attrs:{id:"_1-2-服务保护技术对比"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-服务保护技术对比"}},[s._v("#")]),s._v(" 1.2.服务保护技术对比")]),s._v(" "),n("p",[s._v("在SpringCloud当中支持多种服务保护技术：")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/Netflix/Hystrix",target:"_blank",rel:"noopener noreferrer"}},[s._v("Netfix Hystrix"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/alibaba/Sentinel",target:"_blank",rel:"noopener noreferrer"}},[s._v("Sentinel"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/resilience4j/resilience4j",target:"_blank",rel:"noopener noreferrer"}},[s._v("Resilience4J"),n("OutboundLink")],1)])]),s._v(" "),n("p",[s._v("早期比较流行的是Hystrix框架，但目前国内实用最广泛的还是阿里巴巴的Sentinel框架，这里我们做下对比：")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th"),s._v(" "),n("th",[n("strong",[s._v("Sentinel")])]),s._v(" "),n("th",[n("strong",[s._v("Hystrix")])])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("隔离策略")]),s._v(" "),n("td",[s._v("信号量隔离")]),s._v(" "),n("td",[s._v("线程池隔离/信号量隔离")])]),s._v(" "),n("tr",[n("td",[s._v("熔断降级策略")]),s._v(" "),n("td",[s._v("基于慢调用比例或异常比例")]),s._v(" "),n("td",[s._v("基于失败比率")])]),s._v(" "),n("tr",[n("td",[s._v("实时指标实现")]),s._v(" "),n("td",[s._v("滑动窗口")]),s._v(" "),n("td",[s._v("滑动窗口（基于 RxJava）")])]),s._v(" "),n("tr",[n("td",[s._v("规则配置")]),s._v(" "),n("td",[s._v("支持多种数据源")]),s._v(" "),n("td",[s._v("支持多种数据源")])]),s._v(" "),n("tr",[n("td",[s._v("扩展性")]),s._v(" "),n("td",[s._v("多个扩展点")]),s._v(" "),n("td",[s._v("插件的形式")])]),s._v(" "),n("tr",[n("td",[s._v("基于注解的支持")]),s._v(" "),n("td",[s._v("支持")]),s._v(" "),n("td",[s._v("支持")])]),s._v(" "),n("tr",[n("td",[s._v("限流")]),s._v(" "),n("td",[s._v("基于 QPS，支持基于调用关系的限流")]),s._v(" "),n("td",[s._v("有限的支持")])]),s._v(" "),n("tr",[n("td",[s._v("流量整形")]),s._v(" "),n("td",[s._v("支持慢启动、匀速排队模式")]),s._v(" "),n("td",[s._v("不支持")])]),s._v(" "),n("tr",[n("td",[s._v("系统自适应保护")]),s._v(" "),n("td",[s._v("支持")]),s._v(" "),n("td",[s._v("不支持")])]),s._v(" "),n("tr",[n("td",[s._v("控制台")]),s._v(" "),n("td",[s._v("开箱即用，可配置规则、查看秒级监控、机器发现等")]),s._v(" "),n("td",[s._v("不完善")])]),s._v(" "),n("tr",[n("td",[s._v("常见框架的适配")]),s._v(" "),n("td",[s._v("Servlet、Spring Cloud、Dubbo、gRPC  等")]),s._v(" "),n("td",[s._v("Servlet、Spring Cloud Netflix")])])])]),s._v(" "),n("h2",{attrs:{id:"_1-3-sentinel介绍和安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-sentinel介绍和安装"}},[s._v("#")]),s._v(" 1.3.Sentinel介绍和安装")]),s._v(" "),n("h3",{attrs:{id:"_1-3-1-初识sentinel"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-1-初识sentinel"}},[s._v("#")]),s._v(" 1.3.1.初识Sentinel")]),s._v(" "),n("p",[s._v("Sentinel是阿里巴巴开源的一款微服务流量控制组件。官网地址：https://sentinelguard.io/zh-cn/index.html")]),s._v(" "),n("p",[s._v("Sentinel 具有以下特征:")]),s._v(" "),n("p",[s._v("•"),n("strong",[s._v("丰富的应用场景")]),s._v("：Sentinel 承接了阿里巴巴近 10 年的双十一大促流量的核心场景，例如秒杀（即突发流量控制在系统容量可以承受的范围）、消息削峰填谷、集群流量控制、实时熔断下游不可用应用等。")]),s._v(" "),n("p",[s._v("•"),n("strong",[s._v("完备的实时监控")]),s._v("：Sentinel 同时提供实时的监控功能。您可以在控制台中看到接入应用的单台机器秒级数据，甚至 500 台以下规模的集群的汇总运行情况。")]),s._v(" "),n("p",[s._v("•"),n("strong",[s._v("广泛的开源生态")]),s._v("：Sentinel 提供开箱即用的与其它开源框架/库的整合模块，例如与 Spring Cloud、Dubbo、gRPC 的整合。您只需要引入相应的依赖并进行简单的配置即可快速地接入 Sentinel。")]),s._v(" "),n("p",[s._v("•"),n("strong",[s._v("完善的")]),s._v(" "),n("strong",[s._v("SPI")]),s._v(" "),n("strong",[s._v("扩展点")]),s._v("：Sentinel 提供简单易用、完善的 SPI 扩展接口。您可以通过实现扩展接口来快速地定制逻辑。例如定制规则管理、适配动态数据源等。")]),s._v(" "),n("h3",{attrs:{id:"_1-3-2-安装sentinel"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-2-安装sentinel"}},[s._v("#")]),s._v(" 1.3.2.安装Sentinel")]),s._v(" "),n("p",[s._v("1）下载")]),s._v(" "),n("p",[s._v("sentinel官方提供了UI控制台，方便我们对系统做限流设置。大家可以在"),n("a",{attrs:{href:"https://github.com/alibaba/Sentinel/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),n("OutboundLink")],1),s._v("下载。")]),s._v(" "),n("p",[s._v("课前资料也提供了下载好的jar包：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(975),alt:"image-20210715174252531"}})]),s._v(" "),n("p",[s._v("2）运行")]),s._v(" "),n("p",[s._v("将jar包放到任意非中文目录，执行命令：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v(" sentinel-dashboard-1.8.1.jar\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("如果要修改Sentinel的默认端口、账户、密码，可以通过下列配置：")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[n("strong",[s._v("配置项")])]),s._v(" "),n("th",[n("strong",[s._v("默认值")])]),s._v(" "),n("th",[n("strong",[s._v("说明")])])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("server.port")]),s._v(" "),n("td",[s._v("8080")]),s._v(" "),n("td",[s._v("服务端口")])]),s._v(" "),n("tr",[n("td",[s._v("sentinel.dashboard.auth.username")]),s._v(" "),n("td",[s._v("sentinel")]),s._v(" "),n("td",[s._v("默认用户名")])]),s._v(" "),n("tr",[n("td",[s._v("sentinel.dashboard.auth.password")]),s._v(" "),n("td",[s._v("sentinel")]),s._v(" "),n("td",[s._v("默认密码")])])])]),s._v(" "),n("p",[s._v("例如，修改端口：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Dserver.port")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8090")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v(" sentinel-dashboard-1.8.1.jar\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("3）访问")]),s._v(" "),n("p",[s._v("访问http://localhost:8080页面，就可以看到sentinel的控制台了：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(976),alt:"image-20210715190827846"}})]),s._v(" "),n("p",[s._v("需要输入账号和密码，默认都是：sentinel")]),s._v(" "),n("p",[s._v("登录后，发现一片空白，什么都没有：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(977),alt:"image-20210715191134448"}})]),s._v(" "),n("p",[s._v("这是因为我们还没有与微服务整合。")]),s._v(" "),n("h2",{attrs:{id:"_1-4-微服务整合sentinel"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-微服务整合sentinel"}},[s._v("#")]),s._v(" 1.4.微服务整合Sentinel")]),s._v(" "),n("p",[s._v("我们在order-service中整合sentinel，并连接sentinel的控制台，步骤如下：")]),s._v(" "),n("p",[s._v("1）引入sentinel依赖")]),s._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--sentinel--\x3e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("com.alibaba.cloud"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-cloud-starter-alibaba-sentinel"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("2）配置控制台")]),s._v(" "),n("p",[s._v("修改application.yaml文件，添加下面内容：")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8088")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sentinel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("transport")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dashboard")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("3）访问order-service的任意端点")]),s._v(" "),n("p",[s._v("打开浏览器，访问http://localhost:8088/order/101，这样才能触发sentinel的监控。")]),s._v(" "),n("p",[s._v("然后再访问sentinel的控制台，查看效果：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(978),alt:"image-20210715191241799"}})]),s._v(" "),n("h1",{attrs:{id:"_2-流量控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-流量控制"}},[s._v("#")]),s._v(" 2.流量控制")]),s._v(" "),n("p",[s._v("雪崩问题虽然有四种方案，但是限流是避免服务因突发的流量而发生故障，是对微服务雪崩问题的预防。我们先学习这种模式。")]),s._v(" "),n("h2",{attrs:{id:"_2-1-簇点链路"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-簇点链路"}},[s._v("#")]),s._v(" 2.1.簇点链路")]),s._v(" "),n("p",[s._v("当请求进入微服务时，首先会访问DispatcherServlet，然后进入Controller、Service、Mapper，这样的一个调用链就叫做"),n("strong",[s._v("簇点链路")]),s._v("。簇点链路中被监控的每一个接口就是一个"),n("strong",[s._v("资源")]),s._v("。")]),s._v(" "),n("p",[s._v("默认情况下sentinel会监控SpringMVC的每一个端点（Endpoint，也就是controller中的方法），因此SpringMVC的每一个端点（Endpoint）就是调用链路中的一个资源。")]),s._v(" "),n("p",[s._v("例如，我们刚才访问的order-service中的OrderController中的端点：/order/{orderId}")]),s._v(" "),n("p",[n("img",{attrs:{src:a(373),alt:"image-20210715191757319"}})]),s._v(" "),n("p",[s._v("流控、熔断等都是针对簇点链路中的资源来设置的，因此我们可以点击对应资源后面的按钮来设置规则：")]),s._v(" "),n("ul",[n("li",[s._v("流控：流量控制")]),s._v(" "),n("li",[s._v("降级：降级熔断")]),s._v(" "),n("li",[s._v("热点：热点参数限流，是限流的一种")]),s._v(" "),n("li",[s._v("授权：请求的权限控制")])]),s._v(" "),n("h2",{attrs:{id:"_2-1-快速入门"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-快速入门"}},[s._v("#")]),s._v(" 2.1.快速入门")]),s._v(" "),n("h3",{attrs:{id:"_2-1-1-示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-示例"}},[s._v("#")]),s._v(" 2.1.1.示例")]),s._v(" "),n("p",[s._v("点击资源/order/{orderId}后面的流控按钮，就可以弹出表单。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(373),alt:"image-20210715191757319"}})]),s._v(" "),n("p",[s._v("表单中可以填写限流规则，如下：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(979),alt:"image-20210715192010657"}})]),s._v(" "),n("p",[s._v("其含义是限制 /order/{orderId}这个资源的单机QPS为1，即每秒只允许1次请求，超出的请求会被拦截并报错。")]),s._v(" "),n("h3",{attrs:{id:"_2-1-2-练习"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-练习"}},[s._v("#")]),s._v(" 2.1.2.练习：")]),s._v(" "),n("p",[s._v("需求：给 /order/{orderId}这个资源设置流控规则，QPS不能超过 5，然后测试。")]),s._v(" "),n("p",[s._v("1）首先在sentinel控制台添加限流规则")]),s._v(" "),n("p",[n("img",{attrs:{src:a(980),alt:"image-20210715192455429"}})]),s._v(" "),n("p",[s._v("2）利用jmeter测试")]),s._v(" "),n("p",[s._v("如果没有用过jmeter，可以参考课前资料提供的文档《Jmeter快速入门.md》")]),s._v(" "),n("p",[s._v("课前资料提供了编写好的Jmeter测试样例：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(981),alt:"image-20210715200431615"}})]),s._v(" "),n("p",[s._v("打开jmeter，导入课前资料提供的测试样例：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(982),alt:"image-20210715200537171"}})]),s._v(" "),n("p",[s._v("选择：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(983),alt:"image-20210715200635414"}})]),s._v(" "),n("p",[s._v("20个用户，2秒内运行完，QPS是10，超过了5.")]),s._v(" "),n("p",[s._v("选中"),n("code",[s._v("流控入门，QPS<5")]),s._v("右键运行：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(984),alt:"image-20210715200804594"}})]),s._v(" "),n("blockquote",[n("p",[s._v("注意，不要点击菜单中的执行按钮来运行。")])]),s._v(" "),n("p",[s._v("结果：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(985),alt:"image-20210715200853671"}})]),s._v(" "),n("p",[s._v("可以看到，成功的请求每次只有5个")]),s._v(" "),n("h2",{attrs:{id:"_2-2-流控模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-流控模式"}},[s._v("#")]),s._v(" 2.2.流控模式")]),s._v(" "),n("p",[s._v("在添加限流规则时，点击高级选项，可以选择三种"),n("strong",[s._v("流控模式")]),s._v("：")]),s._v(" "),n("ul",[n("li",[s._v("直接：统计当前资源的请求，触发阈值时对当前资源直接限流，也是默认的模式")]),s._v(" "),n("li",[s._v("关联：统计与当前资源相关的另一个资源，触发阈值时，对当前资源限流")]),s._v(" "),n("li",[s._v("链路：统计从指定链路访问到本资源的请求，触发阈值时，对指定链路限流")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(986),alt:"image-20210715201827886"}})]),s._v(" "),n("p",[s._v("快速入门测试的就是直接模式。")]),s._v(" "),n("h3",{attrs:{id:"_2-2-1-关联模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-关联模式"}},[s._v("#")]),s._v(" 2.2.1.关联模式")]),s._v(" "),n("p",[n("strong",[s._v("关联模式")]),s._v("：统计与当前资源相关的另一个资源，触发阈值时，对当前资源限流")]),s._v(" "),n("p",[n("strong",[s._v("配置规则")]),s._v("：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(987),alt:"image-20210715202540786"}})]),s._v(" "),n("p",[n("strong",[s._v("语法说明")]),s._v("：当/write资源访问量触发阈值时，就会对/read资源限流，避免影响/write资源。")]),s._v(" "),n("p",[n("strong",[s._v("使用场景")]),s._v("：比如用户支付时需要修改订单状态，同时用户要查询订单。查询和修改操作会争抢数据库锁，产生竞争。业务需求是优先支付和更新订单的业务，因此当修改订单业务触发阈值时，需要对查询订单业务限流。")]),s._v(" "),n("p",[n("strong",[s._v("需求说明")]),s._v("：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("在OrderController新建两个端点：/order/query和/order/update，无需实现业务")])]),s._v(" "),n("li",[n("p",[s._v("配置流控规则，当/order/ update资源被访问的QPS超过5时，对/order/query请求限流")])])]),s._v(" "),n("p",[s._v("1）定义/order/query端点，模拟订单查询")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/query"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryOrder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"查询订单成功"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("2）定义/order/update端点，模拟订单更新")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/update"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("updateOrder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"更新订单成功"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("重启服务，查看sentinel控制台的簇点链路：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(988),alt:"image-20210716101805951"}})]),s._v(" "),n("p",[s._v("3）配置流控规则")]),s._v(" "),n("p",[s._v("对哪个端点限流，就点击哪个端点后面的按钮。我们是对订单查询/order/query限流，因此点击它后面的按钮：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(989),alt:"image-20210716101934499"}})]),s._v(" "),n("p",[s._v("在表单中填写流控规则：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(990),alt:"image-20210716102103814"}})]),s._v(" "),n("p",[s._v("4）在Jmeter测试")]),s._v(" "),n("p",[s._v("选择《流控模式-关联》：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(991),alt:"image-20210716102416266"}})]),s._v(" "),n("p",[s._v("可以看到1000个用户，100秒，因此QPS为10，超过了我们设定的阈值：5")]),s._v(" "),n("p",[s._v("查看http请求：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(992),alt:"image-20210716102532554"}})]),s._v(" "),n("p",[s._v("请求的目标是/order/update，这样这个断点就会触发阈值。")]),s._v(" "),n("p",[s._v("但限流的目标是/order/query，我们在浏览器访问，可以发现：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(993),alt:"image-20210716102636030"}})]),s._v(" "),n("p",[s._v("确实被限流了。")]),s._v(" "),n("p",[s._v("5）总结")]),s._v(" "),n("p",[n("img",{attrs:{src:a(994),alt:"image-20210716103143002"}})]),s._v(" "),n("h3",{attrs:{id:"_2-2-2-链路模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-链路模式"}},[s._v("#")]),s._v(" 2.2.2.链路模式")]),s._v(" "),n("p",[n("strong",[s._v("链路模式")]),s._v("：只针对从指定链路访问到本资源的请求做统计，判断是否超过阈值。")]),s._v(" "),n("p",[n("strong",[s._v("配置示例")]),s._v("：")]),s._v(" "),n("p",[s._v("例如有两条请求链路：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("/test1 --\x3e /common")])]),s._v(" "),n("li",[n("p",[s._v("/test2 --\x3e /common")])])]),s._v(" "),n("p",[s._v("如果只希望统计从/test2进入到/common的请求，则可以这样配置：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(995),alt:"image-20210716103536346"}})]),s._v(" "),n("p",[n("strong",[s._v("实战案例")])]),s._v(" "),n("p",[s._v("需求：有查询订单和创建订单业务，两者都需要查询商品。针对从查询订单进入到查询商品的请求统计，并设置限流。")]),s._v(" "),n("p",[s._v("步骤：")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("在OrderService中添加一个queryGoods方法，不用实现业务")])]),s._v(" "),n("li",[n("p",[s._v("在OrderController中，改造/order/query端点，调用OrderService中的queryGoods方法")])]),s._v(" "),n("li",[n("p",[s._v("在OrderController中添加一个/order/save的端点，调用OrderService的queryGoods方法")])]),s._v(" "),n("li",[n("p",[s._v("给queryGoods设置限流规则，从/order/query进入queryGoods的方法限制QPS必须小于2")])])]),s._v(" "),n("p",[s._v("实现：")]),s._v(" "),n("h4",{attrs:{id:"_1-添加查询商品方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-添加查询商品方法"}},[s._v("#")]),s._v(" 1）添加查询商品方法")]),s._v(" "),n("p",[s._v("在order-service服务中，给OrderService类添加一个queryGoods方法：")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryGoods")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"查询商品"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h4",{attrs:{id:"_2-查询订单时-查询商品"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-查询订单时-查询商品"}},[s._v("#")]),s._v(" 2）查询订单时，查询商品")]),s._v(" "),n("p",[s._v("在order-service的OrderController中，修改/order/query端点的业务逻辑：")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/query"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryOrder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 查询商品")]),s._v("\n    orderService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryGoods")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 查询订单")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"查询订单"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"查询订单成功"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h4",{attrs:{id:"_3-新增订单-查询商品"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-新增订单-查询商品"}},[s._v("#")]),s._v(" 3）新增订单，查询商品")]),s._v(" "),n("p",[s._v("在order-service的OrderController中，修改/order/save端点，模拟新增订单：")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/save"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("saveOrder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 查询商品")]),s._v("\n    orderService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryGoods")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 查询订单")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"新增订单"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"新增订单成功"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h4",{attrs:{id:"_4-给查询商品添加资源标记"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-给查询商品添加资源标记"}},[s._v("#")]),s._v(" 4）给查询商品添加资源标记")]),s._v(" "),n("p",[s._v("默认情况下，OrderService中的方法是不被Sentinel监控的，需要我们自己通过注解来标记要监控的方法。")]),s._v(" "),n("p",[s._v("给OrderService的queryGoods方法添加@SentinelResource注解：")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SentinelResource")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"goods"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryGoods")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"查询商品"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("链路模式中，是对不同来源的两个链路做监控。但是sentinel默认会给进入SpringMVC的所有请求设置同一个root资源，会导致链路模式失效。")]),s._v(" "),n("p",[s._v("我们需要关闭这种对SpringMVC的资源聚合，修改order-service服务的application.yml文件：")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sentinel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("web-context-unify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭context整合")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("重启服务，访问/order/query和/order/save，可以查看到sentinel的簇点链路规则中，出现了新的资源：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(996),alt:"image-20210716105227163"}})]),s._v(" "),n("h4",{attrs:{id:"_5-添加流控规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-添加流控规则"}},[s._v("#")]),s._v(" 5）添加流控规则")]),s._v(" "),n("p",[s._v("点击goods资源后面的流控按钮，在弹出的表单中填写下面信息：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(997),alt:"image-20210716105408723"}})]),s._v(" "),n("p",[s._v("只统计从/order/query进入/goods的资源，QPS阈值为2，超出则被限流。")]),s._v(" "),n("h4",{attrs:{id:"_6-jmeter测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-jmeter测试"}},[s._v("#")]),s._v(" 6）Jmeter测试")]),s._v(" "),n("p",[s._v("选择《流控模式-链路》：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(998),alt:"image-20210716105612312"}})]),s._v(" "),n("p",[s._v("可以看到这里200个用户，50秒内发完，QPS为4，超过了我们设定的阈值2")]),s._v(" "),n("p",[s._v("一个http请求是访问/order/save：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(999),alt:"image-20210716105812789"}})]),s._v(" "),n("p",[s._v("运行的结果：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1e3),alt:"image-20210716110027064"}})]),s._v(" "),n("p",[s._v("完全不受影响。")]),s._v(" "),n("p",[s._v("另一个是访问/order/query：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1001),alt:"image-20210716105855951"}})]),s._v(" "),n("p",[s._v("运行结果：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1002),alt:"image-20210716105956401"}})]),s._v(" "),n("p",[s._v("每次只有2个通过。")]),s._v(" "),n("h3",{attrs:{id:"_2-2-3-总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-总结"}},[s._v("#")]),s._v(" 2.2.3.总结")]),s._v(" "),n("p",[s._v("流控模式有哪些？")]),s._v(" "),n("p",[s._v("•直接：对当前资源限流")]),s._v(" "),n("p",[s._v("•关联：高优先级资源触发阈值，对低优先级资源限流。")]),s._v(" "),n("p",[s._v("•链路：阈值统计时，只统计从指定资源进入当前资源的请求，是对请求来源的限流")]),s._v(" "),n("h2",{attrs:{id:"_2-3-流控效果"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-流控效果"}},[s._v("#")]),s._v(" 2.3.流控效果")]),s._v(" "),n("p",[s._v("在流控的高级选项中，还有一个流控效果选项：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1003),alt:"image-20210716110225104"}})]),s._v(" "),n("p",[s._v("流控效果是指请求达到流控阈值时应该采取的措施，包括三种：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("快速失败：达到阈值后，新的请求会被立即拒绝并抛出FlowException异常。是默认的处理方式。")])]),s._v(" "),n("li",[n("p",[s._v("warm up：预热模式，对超出阈值的请求同样是拒绝并抛出异常。但这种模式阈值会动态变化，从一个较小值逐渐增加到最大阈值。")])]),s._v(" "),n("li",[n("p",[s._v("排队等待：让所有的请求按照先后次序排队执行，两个请求的间隔不能小于指定时长")])])]),s._v(" "),n("h3",{attrs:{id:"_2-3-1-warm-up"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-warm-up"}},[s._v("#")]),s._v(" 2.3.1.warm up")]),s._v(" "),n("p",[s._v("阈值一般是一个微服务能承担的最大QPS，但是一个服务刚刚启动时，一切资源尚未初始化（"),n("strong",[s._v("冷启动")]),s._v("），如果直接将QPS跑到最大值，可能导致服务瞬间宕机。")]),s._v(" "),n("p",[s._v("warm up也叫"),n("strong",[s._v("预热模式")]),s._v("，是应对服务冷启动的一种方案。请求阈值初始值是 maxThreshold / coldFactor，持续指定时长后，逐渐提高到maxThreshold值。而coldFactor的默认值是3.")]),s._v(" "),n("p",[s._v("例如，我设置QPS的maxThreshold为10，预热时间为5秒，那么初始阈值就是 10 / 3 ，也就是3，然后在5秒后逐渐增长到10.")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1004),alt:"image-20210716110629796"}})]),s._v(" "),n("p",[n("strong",[s._v("案例")])]),s._v(" "),n("p",[s._v("需求：给/order/{orderId}这个资源设置限流，最大QPS为10，利用warm up效果，预热时长为5秒")]),s._v(" "),n("h4",{attrs:{id:"_1-配置流控规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置流控规则"}},[s._v("#")]),s._v(" 1）配置流控规则：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1005),alt:"image-20210716111012387"}})]),s._v(" "),n("h4",{attrs:{id:"_2-jmeter测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-jmeter测试"}},[s._v("#")]),s._v(" 2）Jmeter测试")]),s._v(" "),n("p",[s._v("选择《流控效果，warm up》：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1006),alt:"image-20210716111136699"}})]),s._v(" "),n("p",[s._v("QPS为10.")]),s._v(" "),n("p",[s._v("刚刚启动时，大部分请求失败，成功的只有3个，说明QPS被限定在3：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1007),alt:"image-20210716111303701"}})]),s._v(" "),n("p",[s._v("随着时间推移，成功比例越来越高：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1008),alt:"image-20210716111404717"}})]),s._v(" "),n("p",[s._v("到Sentinel控制台查看实时监控：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1009),alt:"image-20210716111526480"}})]),s._v(" "),n("p",[s._v("一段时间后：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1010),alt:"image-20210716111658541"}})]),s._v(" "),n("h3",{attrs:{id:"_2-3-2-排队等待"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-排队等待"}},[s._v("#")]),s._v(" 2.3.2.排队等待")]),s._v(" "),n("p",[s._v("当请求超过QPS阈值时，快速失败和warm up 会拒绝新的请求并抛出异常。")]),s._v(" "),n("p",[s._v("而排队等待则是让所有请求进入一个队列中，然后按照阈值允许的时间间隔依次执行。后来的请求必须等待前面执行完成，如果请求预期的等待时间超出最大时长，则会被拒绝。")]),s._v(" "),n("p",[s._v("工作原理")]),s._v(" "),n("p",[s._v("例如：QPS = 5，意味着每200ms处理一个队列中的请求；timeout = 2000，意味着"),n("strong",[s._v("预期等待时长")]),s._v("超过2000ms的请求会被拒绝并抛出异常。")]),s._v(" "),n("p",[s._v("那什么叫做预期等待时长呢？")]),s._v(" "),n("p",[s._v("比如现在一下子来了12 个请求，因为每200ms执行一个请求，那么：")]),s._v(" "),n("ul",[n("li",[s._v("第6个请求的"),n("strong",[s._v("预期等待时长")]),s._v(" =  200 * （6 - 1） = 1000ms")]),s._v(" "),n("li",[s._v("第12个请求的预期等待时长 = 200 * （12-1） = 2200ms")])]),s._v(" "),n("p",[s._v("现在，第1秒同时接收到10个请求，但第2秒只有1个请求，此时QPS的曲线这样的：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1011),alt:"image-20210716113147176"}})]),s._v(" "),n("p",[s._v("如果使用队列模式做流控，所有进入的请求都要排队，以固定的200ms的间隔执行，QPS会变的很平滑：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1012),alt:"image-20210716113426524"}})]),s._v(" "),n("p",[s._v("平滑的QPS曲线，对于服务器来说是更友好的。")]),s._v(" "),n("p",[n("strong",[s._v("案例")])]),s._v(" "),n("p",[s._v("需求：给/order/{orderId}这个资源设置限流，最大QPS为10，利用排队的流控效果，超时时长设置为5s")]),s._v(" "),n("h4",{attrs:{id:"_1-添加流控规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-添加流控规则"}},[s._v("#")]),s._v(" 1）添加流控规则")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1013),alt:"image-20210716114048918"}})]),s._v(" "),n("h4",{attrs:{id:"_2-jmeter测试-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-jmeter测试-2"}},[s._v("#")]),s._v(" 2）Jmeter测试")]),s._v(" "),n("p",[s._v("选择《流控效果，队列》：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1014),alt:"image-20210716114243558"}})]),s._v(" "),n("p",[s._v("QPS为15，已经超过了我们设定的10。")]),s._v(" "),n("p",[s._v("如果是之前的 快速失败、warmup模式，超出的请求应该会直接报错。")]),s._v(" "),n("p",[s._v("但是我们看看队列模式的运行结果：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1015),alt:"image-20210716114429361"}})]),s._v(" "),n("p",[s._v("全部都通过了。")]),s._v(" "),n("p",[s._v("再去sentinel查看实时监控的QPS曲线：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1016),alt:"image-20210716114522935"}})]),s._v(" "),n("p",[s._v("QPS非常平滑，一致保持在10，但是超出的请求没有被拒绝，而是放入队列。因此"),n("strong",[s._v("响应时间")]),s._v("（等待时间）会越来越长。")]),s._v(" "),n("p",[s._v("当队列满了以后，才会有部分请求失败：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1017),alt:"image-20210716114651137"}})]),s._v(" "),n("h3",{attrs:{id:"_2-3-3-总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-总结"}},[s._v("#")]),s._v(" 2.3.3.总结")]),s._v(" "),n("p",[s._v("流控效果有哪些？")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("快速失败：QPS超过阈值时，拒绝新的请求")])]),s._v(" "),n("li",[n("p",[s._v("warm up： QPS超过阈值时，拒绝新的请求；QPS阈值是逐渐提升的，可以避免冷启动时高并发导致服务宕机。")])]),s._v(" "),n("li",[n("p",[s._v("排队等待：请求会进入队列，按照阈值允许的时间间隔依次执行请求；如果请求预期等待时长大于超时时间，直接拒绝")])])]),s._v(" "),n("h2",{attrs:{id:"_2-4-热点参数限流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-热点参数限流"}},[s._v("#")]),s._v(" 2.4.热点参数限流")]),s._v(" "),n("p",[s._v("之前的限流是统计访问某个资源的所有请求，判断是否超过QPS阈值。而热点参数限流是"),n("strong",[s._v("分别统计参数值相同的请求")]),s._v("，判断是否超过QPS阈值。")]),s._v(" "),n("h3",{attrs:{id:"_2-4-1-全局参数限流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-1-全局参数限流"}},[s._v("#")]),s._v(" 2.4.1.全局参数限流")]),s._v(" "),n("p",[s._v("例如，一个根据id查询商品的接口：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1018),alt:"image-20210716115014663"}})]),s._v(" "),n("p",[s._v("访问/goods/{id}的请求中，id参数值会有变化，热点参数限流会根据参数值分别统计QPS，统计结果：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1019),alt:"image-20210716115131463"}})]),s._v(" "),n("p",[s._v("当id=1的请求触发阈值被限流时，id值不为1的请求不受影响。")]),s._v(" "),n("p",[s._v("配置示例：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1020),alt:"image-20210716115232426"}})]),s._v(" "),n("p",[s._v("代表的含义是：对hot这个资源的0号参数（第一个参数）做统计，每1秒"),n("strong",[s._v("相同参数值")]),s._v("的请求数不能超过5")]),s._v(" "),n("h3",{attrs:{id:"_2-4-2-热点参数限流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-2-热点参数限流"}},[s._v("#")]),s._v(" 2.4.2.热点参数限流")]),s._v(" "),n("p",[s._v("刚才的配置中，对查询商品这个接口的所有商品一视同仁，QPS都限定为5.")]),s._v(" "),n("p",[s._v("而在实际开发中，可能部分商品是热点商品，例如秒杀商品，我们希望这部分商品的QPS限制与其它商品不一样，高一些。那就需要配置热点参数限流的高级选项了：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1021),alt:"image-20210716115717523"}})]),s._v(" "),n("p",[s._v("结合上一个配置，这里的含义是对0号的long类型参数限流，每1秒相同参数的QPS不能超过5，有两个例外：")]),s._v(" "),n("p",[s._v("•如果参数值是100，则每1秒允许的QPS为10")]),s._v(" "),n("p",[s._v("•如果参数值是101，则每1秒允许的QPS为15")]),s._v(" "),n("h3",{attrs:{id:"_2-4-4-案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-4-案例"}},[s._v("#")]),s._v(" 2.4.4.案例")]),s._v(" "),n("p",[n("strong",[s._v("案例需求")]),s._v("：给/order/{orderId}这个资源添加热点参数限流，规则如下：")]),s._v(" "),n("p",[s._v("•默认的热点参数规则是每1秒请求量不超过2")]),s._v(" "),n("p",[s._v("•给102这个参数设置例外：每1秒请求量不超过4")]),s._v(" "),n("p",[s._v("•给103这个参数设置例外：每1秒请求量不超过10")]),s._v(" "),n("p",[n("strong",[s._v("注意事项")]),s._v("：热点参数限流对默认的SpringMVC资源无效，需要利用@SentinelResource注解标记资源")]),s._v(" "),n("h4",{attrs:{id:"_1-标记资源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-标记资源"}},[s._v("#")]),s._v(" 1）标记资源")]),s._v(" "),n("p",[s._v("给order-service中的OrderController中的/order/{orderId}资源添加注解：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1022),alt:"image-20210716120033572"}})]),s._v(" "),n("h4",{attrs:{id:"_2-热点参数限流规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-热点参数限流规则"}},[s._v("#")]),s._v(" 2）热点参数限流规则")]),s._v(" "),n("p",[s._v("访问该接口，可以看到我们标记的hot资源出现了：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1023),alt:"image-20210716120208509"}})]),s._v(" "),n("p",[s._v("这里不要点击hot后面的按钮，页面有BUG")]),s._v(" "),n("p",[s._v("点击左侧菜单中"),n("strong",[s._v("热点规则")]),s._v("菜单：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1024),alt:"image-20210716120319009"}})]),s._v(" "),n("p",[s._v("点击新增，填写表单：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1025),alt:"image-20210716120536714"}})]),s._v(" "),n("h4",{attrs:{id:"_3-jmeter测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-jmeter测试"}},[s._v("#")]),s._v(" 3）Jmeter测试")]),s._v(" "),n("p",[s._v("选择《热点参数限流 QPS1》：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1026),alt:"image-20210716120754527"}})]),s._v(" "),n("p",[s._v("这里发起请求的QPS为5.")]),s._v(" "),n("p",[s._v("包含3个http请求：")]),s._v(" "),n("p",[s._v("普通参数，QPS阈值为2")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1027),alt:"image-20210716120840501"}})]),s._v(" "),n("p",[s._v("运行结果：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1028),alt:"image-20210716121105567"}})]),s._v(" "),n("p",[s._v("例外项，QPS阈值为4")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1029),alt:"image-20210716120900365"}})]),s._v(" "),n("p",[s._v("运行结果：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1030),alt:"image-20210716121201630"}})]),s._v(" "),n("p",[s._v("例外项，QPS阈值为10")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1031),alt:"image-20210716120919131"}})]),s._v(" "),n("p",[s._v("运行结果：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1032),alt:"image-20210716121220305"}})]),s._v(" "),n("h1",{attrs:{id:"_3-隔离和降级"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-隔离和降级"}},[s._v("#")]),s._v(" 3.隔离和降级")]),s._v(" "),n("p",[s._v("限流是一种预防措施，虽然限流可以尽量避免因高并发而引起的服务故障，但服务还会因为其它原因而故障。")]),s._v(" "),n("p",[s._v("而要将这些故障控制在一定范围，避免雪崩，就要靠"),n("strong",[s._v("线程隔离")]),s._v("（舱壁模式）和"),n("strong",[s._v("熔断降级")]),s._v("手段了。")]),s._v(" "),n("p",[n("strong",[s._v("线程隔离")]),s._v("之前讲到过：调用者在调用服务提供者时，给每个调用的请求分配独立线程池，出现故障时，最多消耗这个线程池内资源，避免把调用者的所有资源耗尽。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(371),alt:"image-20210715173215243"}})]),s._v(" "),n("p",[n("strong",[s._v("熔断降级")]),s._v("：是在调用方这边加入断路器，统计对服务提供者的调用，如果调用的失败比例过高，则熔断该业务，不允许访问该服务的提供者了。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(372),alt:"image-20210715173428073"}})]),s._v(" "),n("p",[s._v("可以看到，不管是线程隔离还是熔断降级，都是对"),n("strong",[s._v("客户端")]),s._v("（调用方）的保护。需要在"),n("strong",[s._v("调用方")]),s._v(" 发起远程调用时做线程隔离、或者服务熔断。")]),s._v(" "),n("p",[s._v("而我们的微服务远程调用都是基于Feign来完成的，因此我们需要将Feign与Sentinel整合，在Feign里面实现线程隔离和服务熔断。")]),s._v(" "),n("h2",{attrs:{id:"_3-1-feignclient整合sentinel"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-feignclient整合sentinel"}},[s._v("#")]),s._v(" 3.1.FeignClient整合Sentinel")]),s._v(" "),n("p",[s._v("SpringCloud中，微服务调用都是通过Feign来实现的，因此做客户端保护必须整合Feign和Sentinel。")]),s._v(" "),n("h3",{attrs:{id:"_3-1-1-修改配置-开启sentinel功能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-修改配置-开启sentinel功能"}},[s._v("#")]),s._v(" 3.1.1.修改配置，开启sentinel功能")]),s._v(" "),n("p",[s._v("修改OrderService的application.yml文件，开启Feign的Sentinel功能：")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("feign")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sentinel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启feign对sentinel的支持")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"_3-1-2-编写失败降级逻辑"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-编写失败降级逻辑"}},[s._v("#")]),s._v(" 3.1.2.编写失败降级逻辑")]),s._v(" "),n("p",[s._v("业务失败后，不能直接报错，而应该返回用户一个友好提示或者默认结果，这个就是失败降级逻辑。")]),s._v(" "),n("p",[s._v("给FeignClient编写失败后的降级逻辑")]),s._v(" "),n("p",[s._v("①方式一：FallbackClass，无法对远程调用的异常做处理")]),s._v(" "),n("p",[s._v("②方式二：FallbackFactory，可以对远程调用的异常做处理，我们选择这种")]),s._v(" "),n("p",[s._v("这里我们演示方式二的失败降级处理。")]),s._v(" "),n("p",[n("strong",[s._v("步骤一")]),s._v("：在feing-api项目中定义类，实现FallbackFactory：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1033),alt:"image-20210716122403502"}})]),s._v(" "),n("p",[s._v("代码：")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("cn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itcast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("feign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("clients"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("cn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itcast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("feign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("clients"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserClient")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("cn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itcast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("feign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pojo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("feign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hystrix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FallbackFactory")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("lombok"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("extern"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("slf4j"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Slf4j")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Slf4j")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserClientFallbackFactory")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FallbackFactory")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserClient")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("create")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" throwable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("findById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"查询用户异常"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" throwable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[n("strong",[s._v("步骤二")]),s._v("：在feing-api项目中的DefaultFeignConfiguration类中将UserClientFallbackFactory注册为一个Bean：")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserClientFallbackFactory")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("userClientFallbackFactory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserClientFallbackFactory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("strong",[s._v("步骤三")]),s._v("：在feing-api项目中的UserClient接口中使用UserClientFallbackFactory：")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("cn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itcast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("feign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("clients"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fallback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserClientFallbackFactory")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("cn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itcast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("feign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pojo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("openfeign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FeignClient")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bind"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GetMapping")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bind"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PathVariable")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@FeignClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userservice"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fallbackFactory "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserClientFallbackFactory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserClient")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/user/{id}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("findById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@PathVariable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("重启后，访问一次订单查询业务，然后查看sentinel控制台，可以看到新的簇点链路：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1034),alt:"image-20210716123705780"}})]),s._v(" "),n("h3",{attrs:{id:"_3-1-3-总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-总结"}},[s._v("#")]),s._v(" 3.1.3.总结")]),s._v(" "),n("p",[s._v("Sentinel支持的雪崩解决方案：")]),s._v(" "),n("ul",[n("li",[s._v("线程隔离（仓壁模式）")]),s._v(" "),n("li",[s._v("降级熔断")])]),s._v(" "),n("p",[s._v("Feign整合Sentinel的步骤：")]),s._v(" "),n("ul",[n("li",[s._v("在application.yml中配置：feign.sentienl.enable=true")]),s._v(" "),n("li",[s._v("给FeignClient编写FallbackFactory并注册为Bean")]),s._v(" "),n("li",[s._v("将FallbackFactory配置到FeignClient")])]),s._v(" "),n("h2",{attrs:{id:"_3-2-线程隔离-舱壁模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-线程隔离-舱壁模式"}},[s._v("#")]),s._v(" 3.2.线程隔离（舱壁模式）")]),s._v(" "),n("h3",{attrs:{id:"_3-2-1-线程隔离的实现方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-线程隔离的实现方式"}},[s._v("#")]),s._v(" 3.2.1.线程隔离的实现方式")]),s._v(" "),n("p",[s._v("线程隔离有两种方式实现：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("线程池隔离")])]),s._v(" "),n("li",[n("p",[s._v("信号量隔离（Sentinel默认采用）")])])]),s._v(" "),n("p",[s._v("如图：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1035),alt:"image-20210716123036937"}})]),s._v(" "),n("p",[n("strong",[s._v("线程池隔离")]),s._v("：给每个服务调用业务分配一个线程池，利用线程池本身实现隔离效果")]),s._v(" "),n("p",[n("strong",[s._v("信号量隔离")]),s._v("：不创建线程池，而是计数器模式，记录业务使用的线程数量，达到信号量上限时，禁止新的请求。")]),s._v(" "),n("p",[s._v("两者的优缺点：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1036),alt:"image-20210716123240518"}})]),s._v(" "),n("h3",{attrs:{id:"_3-2-2-sentinel的线程隔离"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-sentinel的线程隔离"}},[s._v("#")]),s._v(" 3.2.2.sentinel的线程隔离")]),s._v(" "),n("p",[n("strong",[s._v("用法说明")]),s._v("：")]),s._v(" "),n("p",[s._v("在添加限流规则时，可以选择两种阈值类型：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1037),alt:"image-20210716123411217"}})]),s._v(" "),n("ul",[n("li",[n("p",[s._v("QPS：就是每秒的请求数，在快速入门中已经演示过")])]),s._v(" "),n("li",[n("p",[s._v("线程数：是该资源能使用用的tomcat线程数的最大值。也就是通过限制线程数量，实现"),n("strong",[s._v("线程隔离")]),s._v("（舱壁模式）。")])])]),s._v(" "),n("p",[n("strong",[s._v("案例需求")]),s._v("：给 order-service服务中的UserClient的查询用户接口设置流控规则，线程数不能超过 2。然后利用jemeter测试。")]),s._v(" "),n("h4",{attrs:{id:"_1-配置隔离规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置隔离规则"}},[s._v("#")]),s._v(" 1）配置隔离规则")]),s._v(" "),n("p",[s._v("选择feign接口后面的流控按钮：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1038),alt:"image-20210716123831992"}})]),s._v(" "),n("p",[s._v("填写表单：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1039),alt:"image-20210716123936844"}})]),s._v(" "),n("h4",{attrs:{id:"_2-jmeter测试-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-jmeter测试-3"}},[s._v("#")]),s._v(" 2）Jmeter测试")]),s._v(" "),n("p",[s._v("选择《阈值类型-线程数<2》：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1040),alt:"image-20210716124229894"}})]),s._v(" "),n("p",[s._v("一次发生10个请求，有较大概率并发线程数超过2，而超出的请求会走之前定义的失败降级逻辑。")]),s._v(" "),n("p",[s._v("查看运行结果：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1041),alt:"image-20210716124147820"}})]),s._v(" "),n("p",[s._v("发现虽然结果都是通过了，不过部分请求得到的响应是降级返回的null信息。")]),s._v(" "),n("h3",{attrs:{id:"_3-2-3-总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-总结"}},[s._v("#")]),s._v(" 3.2.3.总结")]),s._v(" "),n("p",[s._v("线程隔离的两种手段是？")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("信号量隔离")])]),s._v(" "),n("li",[n("p",[s._v("线程池隔离")])])]),s._v(" "),n("p",[s._v("信号量隔离的特点是？")]),s._v(" "),n("ul",[n("li",[s._v("基于计数器模式，简单，开销小")])]),s._v(" "),n("p",[s._v("线程池隔离的特点是？")]),s._v(" "),n("ul",[n("li",[s._v("基于线程池模式，有额外开销，但隔离控制更强")])]),s._v(" "),n("h2",{attrs:{id:"_3-3-熔断降级"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-熔断降级"}},[s._v("#")]),s._v(" 3.3.熔断降级")]),s._v(" "),n("p",[s._v("熔断降级是解决雪崩问题的重要手段。其思路是由"),n("strong",[s._v("断路器")]),s._v("统计服务调用的异常比例、慢请求比例，如果超出阈值则会"),n("strong",[s._v("熔断")]),s._v("该服务。即拦截访问该服务的一切请求；而当服务恢复时，断路器会放行访问该服务的请求。")]),s._v(" "),n("p",[s._v("断路器控制熔断和放行是通过状态机来完成的：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1042),alt:"image-20210716130958518"}})]),s._v(" "),n("p",[s._v("状态机包括三个状态：")]),s._v(" "),n("ul",[n("li",[s._v("closed：关闭状态，断路器放行所有请求，并开始统计异常比例、慢请求比例。超过阈值则切换到open状态")]),s._v(" "),n("li",[s._v("open：打开状态，服务调用被"),n("strong",[s._v("熔断")]),s._v("，访问被熔断服务的请求会被拒绝，快速失败，直接走降级逻辑。Open状态5秒后会进入half-open状态")]),s._v(" "),n("li",[s._v("half-open：半开状态，放行一次请求，根据执行结果来判断接下来的操作。\n"),n("ul",[n("li",[s._v("请求成功：则切换到closed状态")]),s._v(" "),n("li",[s._v("请求失败：则切换到open状态")])])])]),s._v(" "),n("p",[s._v("断路器熔断策略有三种：慢调用、异常比例、异常数")]),s._v(" "),n("h3",{attrs:{id:"_3-3-1-慢调用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-慢调用"}},[s._v("#")]),s._v(" 3.3.1.慢调用")]),s._v(" "),n("p",[n("strong",[s._v("慢调用")]),s._v("：业务的响应时长（RT）大于指定时长的请求认定为慢调用请求。在指定时间内，如果请求数量超过设定的最小数量，慢调用比例大于设定的阈值，则触发熔断。")]),s._v(" "),n("p",[s._v("例如：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1043),alt:"image-20210716145934347"}})]),s._v(" "),n("p",[s._v("解读：RT超过500ms的调用是慢调用，统计最近10000ms内的请求，如果请求量超过10次，并且慢调用比例不低于0.5，则触发熔断，熔断时长为5秒。然后进入half-open状态，放行一次请求做测试。")]),s._v(" "),n("p",[n("strong",[s._v("案例")])]),s._v(" "),n("p",[s._v("需求：给 UserClient的查询用户接口设置降级规则，慢调用的RT阈值为50ms，统计时间为1秒，最小请求数量为5，失败阈值比例为0.4，熔断时长为5")]),s._v(" "),n("h4",{attrs:{id:"_1-设置慢调用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-设置慢调用"}},[s._v("#")]),s._v(" 1）设置慢调用")]),s._v(" "),n("p",[s._v("修改user-service中的/user/{id}这个接口的业务。通过休眠模拟一个延迟时间：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1044),alt:"image-20210716150234787"}})]),s._v(" "),n("p",[s._v("此时，orderId=101的订单，关联的是id为1的用户，调用时长为60ms：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1045),alt:"image-20210716150510956"}})]),s._v(" "),n("p",[s._v("orderId=102的订单，关联的是id为2的用户，调用时长为非常短；")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1046),alt:"image-20210716150605208"}})]),s._v(" "),n("h4",{attrs:{id:"_2-设置熔断规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-设置熔断规则"}},[s._v("#")]),s._v(" 2）设置熔断规则")]),s._v(" "),n("p",[s._v("下面，给feign接口设置降级规则：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(374),alt:"image-20210716150654094"}})]),s._v(" "),n("p",[s._v("规则：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1047),alt:"image-20210716150740434"}})]),s._v(" "),n("p",[s._v("超过50ms的请求都会被认为是慢请求")]),s._v(" "),n("h4",{attrs:{id:"_3-测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试"}},[s._v("#")]),s._v(" 3）测试")]),s._v(" "),n("p",[s._v("在浏览器访问：http://localhost:8088/order/101，快速刷新5次，可以发现：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1048),alt:"image-20210716150911004"}})]),s._v(" "),n("p",[s._v("触发了熔断，请求时长缩短至5ms，快速失败了，并且走降级逻辑，返回的null")]),s._v(" "),n("p",[s._v("在浏览器访问：http://localhost:8088/order/102，竟然也被熔断了：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1049),alt:"image-20210716151107785"}})]),s._v(" "),n("h3",{attrs:{id:"_3-3-2-异常比例、异常数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-异常比例、异常数"}},[s._v("#")]),s._v(" 3.3.2.异常比例、异常数")]),s._v(" "),n("p",[n("strong",[s._v("异常比例或异常数")]),s._v("：统计指定时间内的调用，如果调用次数超过指定请求数，并且出现异常的比例达到设定的比例阈值（或超过指定异常数），则触发熔断。")]),s._v(" "),n("p",[s._v("例如，一个异常比例设置：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1050),alt:"image-20210716131430682"}})]),s._v(" "),n("p",[s._v("解读：统计最近1000ms内的请求，如果请求量超过10次，并且异常比例不低于0.4，则触发熔断。")]),s._v(" "),n("p",[s._v("一个异常数设置：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1051),alt:"image-20210716131522912"}})]),s._v(" "),n("p",[s._v("解读：统计最近1000ms内的请求，如果请求量超过10次，并且异常比例不低于2次，则触发熔断。")]),s._v(" "),n("p",[n("strong",[s._v("案例")])]),s._v(" "),n("p",[s._v("需求：给 UserClient的查询用户接口设置降级规则，统计时间为1秒，最小请求数量为5，失败阈值比例为0.4，熔断时长为5s")]),s._v(" "),n("h4",{attrs:{id:"_1-设置异常请求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-设置异常请求"}},[s._v("#")]),s._v(" 1）设置异常请求")]),s._v(" "),n("p",[s._v("首先，修改user-service中的/user/{id}这个接口的业务。手动抛出异常，以触发异常比例的熔断：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1052),alt:"image-20210716151348183"}})]),s._v(" "),n("p",[s._v("也就是说，id 为 2时，就会触发异常")]),s._v(" "),n("h4",{attrs:{id:"_2-设置熔断规则-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-设置熔断规则-2"}},[s._v("#")]),s._v(" 2）设置熔断规则")]),s._v(" "),n("p",[s._v("下面，给feign接口设置降级规则：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(374),alt:"image-20210716150654094"}})]),s._v(" "),n("p",[s._v("规则：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1053),alt:"image-20210716151538785"}})]),s._v(" "),n("p",[s._v("在5次请求中，只要异常比例超过0.4，也就是有2次以上的异常，就会触发熔断。")]),s._v(" "),n("h4",{attrs:{id:"_3-测试-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试-2"}},[s._v("#")]),s._v(" 3）测试")]),s._v(" "),n("p",[s._v("在浏览器快速访问：http://localhost:8088/order/102，快速刷新5次，触发熔断：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1054),alt:"image-20210716151722916"}})]),s._v(" "),n("p",[s._v("此时，我们去访问本来应该正常的103：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1055),alt:"image-20210716151844817"}})]),s._v(" "),n("h1",{attrs:{id:"_4-授权规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-授权规则"}},[s._v("#")]),s._v(" 4.授权规则")]),s._v(" "),n("p",[s._v("授权规则可以对请求方来源做判断和控制。")]),s._v(" "),n("h2",{attrs:{id:"_4-1-授权规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-授权规则"}},[s._v("#")]),s._v(" 4.1.授权规则")]),s._v(" "),n("h3",{attrs:{id:"_4-1-1-基本规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-1-基本规则"}},[s._v("#")]),s._v(" 4.1.1.基本规则")]),s._v(" "),n("p",[s._v("授权规则可以对调用方的来源做控制，有白名单和黑名单两种方式。")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("白名单：来源（origin）在白名单内的调用者允许访问")])]),s._v(" "),n("li",[n("p",[s._v("黑名单：来源（origin）在黑名单内的调用者不允许访问")])])]),s._v(" "),n("p",[s._v("点击左侧菜单的授权，可以看到授权规则：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1056),alt:"image-20210716152010750"}})]),s._v(" "),n("ul",[n("li",[n("p",[s._v("资源名：就是受保护的资源，例如/order/{orderId}")])]),s._v(" "),n("li",[n("p",[s._v("流控应用：是来源者的名单，")]),s._v(" "),n("ul",[n("li",[s._v("如果是勾选白名单，则名单中的来源被许可访问。")]),s._v(" "),n("li",[s._v("如果是勾选黑名单，则名单中的来源被禁止访问。")])])])]),s._v(" "),n("p",[s._v("比如：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1057),alt:"image-20210716152349191"}})]),s._v(" "),n("p",[s._v("我们允许请求从gateway到order-service，不允许浏览器访问order-service，那么白名单中就要填写"),n("strong",[s._v("网关的来源名称（origin）")]),s._v("。")]),s._v(" "),n("h3",{attrs:{id:"_4-1-2-如何获取origin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-2-如何获取origin"}},[s._v("#")]),s._v(" 4.1.2.如何获取origin")]),s._v(" "),n("p",[s._v("Sentinel是通过RequestOriginParser这个接口的parseOrigin来获取请求的来源的。")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RequestOriginParser")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 从请求request对象中获取origin，获取方式自定义\n     */")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("parseOrigin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("这个方法的作用就是从request对象中，获取请求者的origin值并返回。")]),s._v(" "),n("p",[s._v("默认情况下，sentinel不管请求者从哪里来，返回值永远是default，也就是说一切请求的来源都被认为是一样的值default。")]),s._v(" "),n("p",[s._v("因此，我们需要自定义这个接口的实现，让"),n("strong",[s._v("不同的请求，返回不同的origin")]),s._v("。")]),s._v(" "),n("p",[s._v("例如order-service服务中，我们定义一个RequestOriginParser的实现类：")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("cn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itcast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sentinel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alibaba"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("adapter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("webmvc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RequestOriginParser")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("stereotype"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Component")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringUtils")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("javax"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("servlet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HeaderOriginParser")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RequestOriginParser")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("parseOrigin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1.获取请求头")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" origin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"origin"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2.非空判断")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringUtils")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("isEmpty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("origin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            origin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"blank"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" origin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[s._v("我们会尝试从request-header中获取origin值。")]),s._v(" "),n("h3",{attrs:{id:"_4-1-3-给网关添加请求头"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-3-给网关添加请求头"}},[s._v("#")]),s._v(" 4.1.3.给网关添加请求头")]),s._v(" "),n("p",[s._v("既然获取请求origin的方式是从reques-header中获取origin值，我们必须让"),n("strong",[s._v("所有从gateway路由到微服务的请求都带上origin头")]),s._v("。")]),s._v(" "),n("p",[s._v("这个需要利用之前学习的一个GatewayFilter来实现，AddRequestHeaderGatewayFilter。")]),s._v(" "),n("p",[s._v("修改gateway服务中的application.yml，添加一个defaultFilter：")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateway")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default-filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" AddRequestHeader=origin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("gateway\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("routes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...略")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("这样，从gateway路由的所有请求都会带上origin头，值为gateway。而从其它地方到达微服务的请求则没有这个头。")]),s._v(" "),n("h3",{attrs:{id:"_4-1-4-配置授权规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-4-配置授权规则"}},[s._v("#")]),s._v(" 4.1.4.配置授权规则")]),s._v(" "),n("p",[s._v("接下来，我们添加一个授权规则，放行origin值为gateway的请求。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1058),alt:"image-20210716153250134"}})]),s._v(" "),n("p",[s._v("配置如下：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1059),alt:"image-20210716153301069"}})]),s._v(" "),n("p",[s._v("现在，我们直接跳过网关，访问order-service服务：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1060),alt:"image-20210716153348396"}})]),s._v(" "),n("p",[s._v("通过网关访问：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1061),alt:"image-20210716153434095"}})]),s._v(" "),n("h2",{attrs:{id:"_4-2-自定义异常结果"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-自定义异常结果"}},[s._v("#")]),s._v(" 4.2.自定义异常结果")]),s._v(" "),n("p",[s._v("默认情况下，发生限流、降级、授权拦截时，都会抛出异常到调用方。异常结果都是flow limmiting（限流）。这样不够友好，无法得知是限流还是降级还是授权拦截。")]),s._v(" "),n("h3",{attrs:{id:"_4-2-1-异常类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-异常类型"}},[s._v("#")]),s._v(" 4.2.1.异常类型")]),s._v(" "),n("p",[s._v("而如果要自定义异常时的返回结果，需要实现BlockExceptionHandler接口：")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockExceptionHandler")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 处理请求被限流、降级、授权拦截时抛出的异常：BlockException\n     */")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("handle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletResponse")]),s._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockException")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("这个方法有三个参数：")]),s._v(" "),n("ul",[n("li",[s._v("HttpServletRequest request：request对象")]),s._v(" "),n("li",[s._v("HttpServletResponse response：response对象")]),s._v(" "),n("li",[s._v("BlockException e：被sentinel拦截时抛出的异常")])]),s._v(" "),n("p",[s._v("这里的BlockException包含多个不同的子类：")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[n("strong",[s._v("异常")])]),s._v(" "),n("th",[n("strong",[s._v("说明")])])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("FlowException")]),s._v(" "),n("td",[s._v("限流异常")])]),s._v(" "),n("tr",[n("td",[s._v("ParamFlowException")]),s._v(" "),n("td",[s._v("热点参数限流的异常")])]),s._v(" "),n("tr",[n("td",[s._v("DegradeException")]),s._v(" "),n("td",[s._v("降级异常")])]),s._v(" "),n("tr",[n("td",[s._v("AuthorityException")]),s._v(" "),n("td",[s._v("授权规则异常")])]),s._v(" "),n("tr",[n("td",[s._v("SystemBlockException")]),s._v(" "),n("td",[s._v("系统规则异常")])])])]),s._v(" "),n("h3",{attrs:{id:"_4-2-2-自定义异常处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2-自定义异常处理"}},[s._v("#")]),s._v(" 4.2.2.自定义异常处理")]),s._v(" "),n("p",[s._v("下面，我们就在order-service定义一个自定义异常处理类：")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("cn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itcast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sentinel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alibaba"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("adapter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("webmvc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockExceptionHandler")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alibaba"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("slots"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("block"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockException")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alibaba"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("slots"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("block"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authority"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthorityException")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alibaba"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("slots"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("block"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("degrade"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DegradeException")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alibaba"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("slots"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("block"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FlowException")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alibaba"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("slots"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("block"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("param"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ParamFlowException")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("stereotype"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Component")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("javax"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("servlet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token import"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("javax"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("servlet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletResponse")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SentinelExceptionHandler")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockExceptionHandler")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("handle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletResponse")]),s._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockException")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" msg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"未知异常"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" status "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("429")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FlowException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            msg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"请求被限流了"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ParamFlowException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            msg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"请求被热点参数限流"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DegradeException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            msg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"请求被降级了"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthorityException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            msg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"没有权限访问"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            status "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("401")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setContentType")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"application/json;charset=utf-8"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setStatus")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getWriter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{\\"msg\\": "')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" msg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('", \\"status\\": "')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" status "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("p",[s._v("重启测试，在不同场景下，会返回不同的异常消息.")]),s._v(" "),n("p",[s._v("限流：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1062),alt:"image-20210716153938887"}})]),s._v(" "),n("p",[s._v("授权拦截时：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1063),alt:"image-20210716154012736"}})]),s._v(" "),n("h1",{attrs:{id:"_5-规则持久化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-规则持久化"}},[s._v("#")]),s._v(" 5.规则持久化")]),s._v(" "),n("p",[s._v("现在，sentinel的所有规则都是内存存储，重启后所有规则都会丢失。在生产环境下，我们必须确保这些规则的持久化，避免丢失。")]),s._v(" "),n("h2",{attrs:{id:"_5-1-规则管理模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-规则管理模式"}},[s._v("#")]),s._v(" 5.1.规则管理模式")]),s._v(" "),n("p",[s._v("规则是否能持久化，取决于规则管理模式，sentinel支持三种规则管理模式：")]),s._v(" "),n("ul",[n("li",[s._v("原始模式：Sentinel的默认模式，将规则保存在内存，重启服务会丢失。")]),s._v(" "),n("li",[s._v("pull模式")]),s._v(" "),n("li",[s._v("push模式")])]),s._v(" "),n("h3",{attrs:{id:"_5-1-1-pull模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-pull模式"}},[s._v("#")]),s._v(" 5.1.1.pull模式")]),s._v(" "),n("p",[s._v("pull模式：控制台将配置的规则推送到Sentinel客户端，而客户端会将配置规则保存在本地文件或数据库中。以后会定时去本地文件或数据库中查询，更新本地规则。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1064),alt:"image-20210716154155238"}})]),s._v(" "),n("h3",{attrs:{id:"_5-1-2-push模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-push模式"}},[s._v("#")]),s._v(" 5.1.2.push模式")]),s._v(" "),n("p",[s._v("push模式：控制台将配置规则推送到远程配置中心，例如Nacos。Sentinel客户端监听Nacos，获取配置变更的推送消息，完成本地配置更新。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1065),alt:"image-20210716154215456"}})]),s._v(" "),n("h2",{attrs:{id:"_5-2-实现push模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-实现push模式"}},[s._v("#")]),s._v(" 5.2.实现push模式")]),s._v(" "),n("p",[s._v("详细步骤可以参考课前资料的《sentinel规则持久化》：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1066),alt:"image-20210716154255466"}})])])}),[],!1,null,null,null);t.default=e.exports},371:function(s,t,a){s.exports=a.p+"assets/img/image-20210715173215243.2391fa4b.png"},372:function(s,t,a){s.exports=a.p+"assets/img/image-20210715173428073.7bc5e928.png"},373:function(s,t,a){s.exports=a.p+"assets/img/image-20210715191757319.c644ac82.png"},374:function(s,t,a){s.exports=a.p+"assets/img/image-20210716150654094.d19bf916.png"},967:function(s,t,a){s.exports=a.p+"assets/img/1533829099748.976f74e6.png"},968:function(s,t,a){s.exports=a.p+"assets/img/1533829198240.b8d06384.png"},969:function(s,t,a){s.exports=a.p+"assets/img/1533829307389.3e771489.png"},970:function(s,t,a){s.exports=a.p+"assets/img/image-20210715172710340.50ae2f63.png"},971:function(s,t,a){s.exports=a.p+"assets/img/image-20210715172820438.a77a5b47.png"},972:function(s,t,a){s.exports=a.p+"assets/img/image-20210715172946352.d83d71a0.png"},973:function(s,t,a){s.exports=a.p+"assets/img/image-20210715173327075.32770b97.png"},974:function(s,t,a){s.exports=a.p+"assets/img/image-20210715173555158.254cf2e5.png"},975:function(s,t,a){s.exports=a.p+"assets/img/image-20210715174252531.7ea627c1.png"},976:function(s,t,a){s.exports=a.p+"assets/img/image-20210715190827846.f7928f93.png"},977:function(s,t,a){s.exports=a.p+"assets/img/image-20210715191134448.019bb7e3.png"},978:function(s,t,a){s.exports=a.p+"assets/img/image-20210715191241799.fb910e1d.png"},979:function(s,t,a){s.exports=a.p+"assets/img/image-20210715192010657.7e5f2359.png"},980:function(s,t,a){s.exports=a.p+"assets/img/image-20210715192455429.e31a07b2.png"},981:function(s,t,a){s.exports=a.p+"assets/img/image-20210715200431615.025e011a.png"},982:function(s,t){s.exports="data:image/png;base64,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"},983:function(s,t,a){s.exports=a.p+"assets/img/image-20210715200635414.0d72ce25.png"},984:function(s,t,a){s.exports=a.p+"assets/img/image-20210715200804594.d435d9e7.png"},985:function(s,t,a){s.exports=a.p+"assets/img/image-20210715200853671.740614f3.png"},986:function(s,t,a){s.exports=a.p+"assets/img/image-20210715201827886.d4971193.png"},987:function(s,t,a){s.exports=a.p+"assets/img/image-20210715202540786.960f3c52.png"},988:function(s,t,a){s.exports=a.p+"assets/img/image-20210716101805951.7056a01d.png"},989:function(s,t,a){s.exports=a.p+"assets/img/image-20210716101934499.4ff54507.png"},990:function(s,t,a){s.exports=a.p+"assets/img/image-20210716102103814.b1e14089.png"},991:function(s,t,a){s.exports=a.p+"assets/img/image-20210716102416266.1ff5d098.png"},992:function(s,t,a){s.exports=a.p+"assets/img/image-20210716102532554.d4fd0c77.png"},993:function(s,t,a){s.exports=a.p+"assets/img/image-20210716102636030.13985fa5.png"},994:function(s,t,a){s.exports=a.p+"assets/img/image-20210716103143002.4815ec6e.png"},995:function(s,t,a){s.exports=a.p+"assets/img/image-20210716103536346.47ed6f18.png"},996:function(s,t,a){s.exports=a.p+"assets/img/image-20210716105227163.4f3cbd61.png"},997:function(s,t,a){s.exports=a.p+"assets/img/image-20210716105408723.470b0f19.png"},998:function(s,t,a){s.exports=a.p+"assets/img/image-20210716105612312.f36a267a.png"},999:function(s,t,a){s.exports=a.p+"assets/img/image-20210716105812789.3dd359c7.png"}}]);