(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1067:function(s,a,t){s.exports=t.p+"assets/img/image-20210713202807818.7ca2e0e8.png"},1068:function(s,a,t){s.exports=t.p+"assets/img/image-20210713203124797.ea41782e.png"},1069:function(s,a,t){s.exports=t.p+"assets/img/image-20210713203753373.bf4a4b52.png"},1070:function(s,a,t){s.exports=t.p+"assets/img/image-20210713204155887.c2272f44.png"},1071:function(s,a,t){s.exports=t.p+"assets/img/image-20210713205003790.f2ae905c.png"},1072:function(s,a,t){s.exports=t.p+"assets/img/image-20210713210800950.809884ea.png"},1073:function(s,a,t){s.exports=t.p+"assets/img/image-20210713211009593.d4fc004c.png"},1074:function(s,a,t){s.exports=t.p+"assets/img/image-20210713211417049.615ba507.png"},1075:function(s,a,t){s.exports=t.p+"assets/img/image-20210713211550169.1d17cdb7.png"},1076:function(s,a,t){s.exports=t.p+"assets/img/image-20210713211657319.b977bf99.png"},1077:function(s,a,t){s.exports=t.p+"assets/img/image-20210713211814094.693cf885.png"},1078:function(s,a,t){s.exports=t.p+"assets/img/image-20210713212656887.605ea50d.png"},1079:function(s,a){s.exports="data:image/png;base64,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"},1080:function(s,a,t){s.exports=t.p+"assets/img/image-20210713212336185.d099c550.png"},1081:function(s,a,t){s.exports=t.p+"assets/img/image-20210713212513324.8ebc08f6.png"},1082:function(s,a,t){s.exports=t.p+"assets/img/image-20210713220736408.87d18778.png"},1083:function(s,a,t){s.exports=t.p+"assets/img/image-20210713212749575.27d16743.png"},1084:function(s,a,t){s.exports=t.p+"assets/img/image-20210713212901725.dccdc0e1.png"},1085:function(s,a,t){s.exports=t.p+"assets/img/image-20210713213146089.296f386c.png"},1086:function(s,a,t){s.exports=t.p+"assets/img/image-20210713213213075.25998742.png"},1087:function(s,a,t){s.exports=t.p+"assets/img/image-20210713213312278.e205f616.png"},1088:function(s,a,t){s.exports=t.p+"assets/img/image-20210713213959569.dd3a1896.png"},1089:function(s,a,t){s.exports=t.p+"assets/img/image-20210713214404481.0c321504.png"},1090:function(s,a,t){s.exports=t.p+"assets/img/image-20210713214925388.76b879c9.png"},1091:function(s,a,t){s.exports=t.p+"assets/img/image-20210713220104956.1367a471.png"},1092:function(s,a,t){s.exports=t.p+"assets/img/image-20210713220509769.580d97e3.png"},1093:function(s,a,t){s.exports=t.p+"assets/img/image-20210713220605881.438bd7fc.png"},1094:function(s,a,t){s.exports=t.p+"assets/img/image-20210713220857396.9e2ff925.png"},1095:function(s,a,t){s.exports=t.p+"assets/img/image-20210713221339022.3f28c642.png"},1096:function(s,a,t){s.exports=t.p+"assets/img/image-20210713222157190.1c6f2cf6.png"},1097:function(s,a,t){s.exports=t.p+"assets/img/image-20210713222656562.51b65dd2.png"},1098:function(s,a,t){s.exports=t.p+"assets/img/image-20210713222757702.525d9646.png"},1099:function(s,a,t){s.exports=t.p+"assets/img/image-20210713222841951.4df1ed18.png"},1100:function(s,a,t){s.exports=t.p+"assets/img/image-20210713223041491.5994e7d1.png"},1101:function(s,a,t){s.exports=t.p+"assets/img/image-20210713223150650.f4e4b411.png"},1102:function(s,a,t){s.exports=t.p+"assets/img/image-20210713224049419.8f5661e9.png"},1103:function(s,a,t){s.exports=t.p+"assets/img/image-20210713224245731.e51bc0b3.png"},1104:function(s,a,t){s.exports=t.p+"assets/img/image-20210713224517686.0c7051d4.png"},1105:function(s,a,t){s.exports=t.p+"assets/img/1525620483637.60e5fa18.png"},1106:function(s,a,t){s.exports=t.p+"assets/img/1525620787090.d8822cdf.png"},1107:function(s,a,t){s.exports=t.p+"assets/img/1544361421671.07ef505a.png"},1108:function(s,a,t){s.exports=t.p+"assets/img/1525622652849.8d1b54b3.png"},1109:function(s,a,t){s.exports=t.p+"assets/img/1525622699666.08de5bce.png"},1110:function(s,a,t){s.exports=t.p+"assets/img/1525622754316.e773db07.png"},1111:function(s,a,t){s.exports=t.p+"assets/img/image-20210713224724673.a3414a08.png"},1112:function(s,a,t){s.exports=t.p+"assets/img/image-20210713225653000.4c64b5c6.png"},1113:function(s,a,t){s.exports=t.p+"assets/img/image-20210713230444308.142c8955.png"},1114:function(s,a,t){s.exports=t.p+"assets/img/image-20210713231439607.eafb858e.png"},1115:function(s,a,t){s.exports=t.p+"assets/img/image-20210713232522531.0c1c87e7.png"},1116:function(s,a,t){s.exports=t.p+"assets/img/image-20210713232658928.9f26138f.png"},1117:function(s,a,t){s.exports=t.p+"assets/img/image-20210713232916215.f7fa2928.png"},1118:function(s,a,t){s.exports=t.p+"assets/img/image-20210713233528982.26978d78.png"},1119:function(s,a,t){s.exports=t.p+"assets/img/image-20210713233727923.74a4c70a.png"},1120:function(s,a,t){s.exports=t.p+"assets/img/image-20210713235133225.4dd758c0.png"},1121:function(s,a,t){s.exports=t.p+"assets/img/image-20210713235235219.18b215fa.png"},1122:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000101516.382dff09.png"},1123:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000414781.158a77ed.png"},1124:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000440143.696641e9.png"},1125:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000505928.95069944.png"},1126:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000522913.42c42c38.png"},1127:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000830703.e601f03b.png"},1128:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000837140.e7783d8d.png"},1129:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000941256.1252aee0.png"},1130:function(s,a,t){s.exports=t.p+"assets/img/image-20210714001728017.98fc233f.png"},1719:function(s,a,t){"use strict";t.r(a);var e=t(1),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"springcloud"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#springcloud"}},[s._v("#")]),s._v(" SpringCloud")]),s._v(" "),e("h1",{attrs:{id:"_1-认识微服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-认识微服务"}},[s._v("#")]),s._v(" 1.认识微服务")]),s._v(" "),e("p",[s._v("随着互联网行业的发展，对服务的要求也越来越高，服务架构也从单体架构逐渐演变为现在流行的微服务架构。这些架构之间有怎样的差别呢？")]),s._v(" "),e("h2",{attrs:{id:"_1-1-单体架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-单体架构"}},[s._v("#")]),s._v(" 1.1.单体架构")]),s._v(" "),e("p",[e("strong",[s._v("单体架构")]),s._v("：将业务的所有功能集中在一个项目中开发，打成一个包部署。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1067),alt:"image-20210713202807818"}})]),s._v(" "),e("p",[s._v("单体架构的优缺点如下：")]),s._v(" "),e("p",[e("strong",[s._v("优点：")])]),s._v(" "),e("ul",[e("li",[s._v("架构简单")]),s._v(" "),e("li",[s._v("部署成本低")])]),s._v(" "),e("p",[e("strong",[s._v("缺点：")])]),s._v(" "),e("ul",[e("li",[s._v("耦合度高（维护困难、升级困难）")])]),s._v(" "),e("h2",{attrs:{id:"_1-2-分布式架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-分布式架构"}},[s._v("#")]),s._v(" 1.2.分布式架构")]),s._v(" "),e("p",[e("strong",[s._v("分布式架构")]),s._v("：根据业务功能对系统做拆分，每个业务功能模块作为独立项目开发，称为一个服务。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1068),alt:"image-20210713203124797"}})]),s._v(" "),e("p",[s._v("分布式架构的优缺点：")]),s._v(" "),e("p",[e("strong",[s._v("优点：")])]),s._v(" "),e("ul",[e("li",[s._v("降低服务耦合")]),s._v(" "),e("li",[s._v("有利于服务升级和拓展")])]),s._v(" "),e("p",[e("strong",[s._v("缺点：")])]),s._v(" "),e("ul",[e("li",[s._v("服务调用关系错综复杂")])]),s._v(" "),e("p",[s._v("分布式架构虽然降低了服务耦合，但是服务拆分时也有很多问题需要思考：")]),s._v(" "),e("ul",[e("li",[s._v("服务拆分的粒度如何界定？")]),s._v(" "),e("li",[s._v("服务之间如何调用？")]),s._v(" "),e("li",[s._v("服务的调用关系如何管理？")])]),s._v(" "),e("p",[s._v("人们需要制定一套行之有效的标准来约束分布式架构。")]),s._v(" "),e("h2",{attrs:{id:"_1-3-微服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-微服务"}},[s._v("#")]),s._v(" 1.3.微服务")]),s._v(" "),e("p",[s._v("微服务的架构特征：")]),s._v(" "),e("ul",[e("li",[s._v("单一职责：微服务拆分粒度更小，每一个服务都对应唯一的业务能力，做到单一职责")]),s._v(" "),e("li",[s._v("自治：团队独立、技术独立、数据独立，独立部署和交付")]),s._v(" "),e("li",[s._v("面向服务：服务提供统一标准的接口，与语言和技术无关")]),s._v(" "),e("li",[s._v("隔离性强：服务调用做好隔离、容错、降级，避免出现级联问题")])]),s._v(" "),e("p",[e("img",{attrs:{src:t(1069),alt:"image-20210713203753373"}})]),s._v(" "),e("p",[s._v("微服务的上述特性其实是在给分布式架构制定一个标准，进一步降低服务之间的耦合度，提供服务的独立性和灵活性。做到高内聚，低耦合。")]),s._v(" "),e("p",[s._v("因此，可以认为"),e("strong",[s._v("微服务")]),s._v("是一种经过良好架构设计的"),e("strong",[s._v("分布式架构方案")]),s._v(" 。")]),s._v(" "),e("p",[s._v("但方案该怎么落地？选用什么样的技术栈？全球的互联网公司都在积极尝试自己的微服务落地方案。")]),s._v(" "),e("p",[s._v("其中在Java领域最引人注目的就是SpringCloud提供的方案了。")]),s._v(" "),e("h2",{attrs:{id:"_1-4-springcloud"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-springcloud"}},[s._v("#")]),s._v(" 1.4.SpringCloud")]),s._v(" "),e("p",[s._v("SpringCloud是目前国内使用最广泛的微服务框架。官网地址：https://spring.io/projects/spring-cloud。")]),s._v(" "),e("p",[s._v("SpringCloud集成了各种微服务功能组件，并基于SpringBoot实现了这些组件的自动装配，从而提供了良好的开箱即用体验。")]),s._v(" "),e("p",[s._v("其中常见的组件包括：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1070),alt:"image-20210713204155887"}})]),s._v(" "),e("p",[s._v("另外，SpringCloud底层是依赖于SpringBoot的，并且有版本的兼容关系，如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1071),alt:"image-20210713205003790"}})]),s._v(" "),e("p",[s._v("我们课堂学习的版本是 Hoxton.SR10，因此对应的SpringBoot版本是2.3.x版本。")]),s._v(" "),e("h2",{attrs:{id:"_1-5-总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-总结"}},[s._v("#")]),s._v(" 1.5.总结")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("单体架构：简单方便，高度耦合，扩展性差，适合小型项目。例如：学生管理系统")])]),s._v(" "),e("li",[e("p",[s._v("分布式架构：松耦合，扩展性好，但架构复杂，难度大。适合大型互联网项目，例如：京东、淘宝")])]),s._v(" "),e("li",[e("p",[s._v("微服务：一种良好的分布式架构方案")]),s._v(" "),e("p",[s._v("①优点：拆分粒度更小、服务更独立、耦合度更低")]),s._v(" "),e("p",[s._v("②缺点：架构非常复杂，运维、监控、部署难度提高")])]),s._v(" "),e("li",[e("p",[s._v("SpringCloud是微服务架构的一站式解决方案，集成了各种优秀微服务功能组件")])])]),s._v(" "),e("h1",{attrs:{id:"_2-服务拆分和远程调用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-服务拆分和远程调用"}},[s._v("#")]),s._v(" 2.服务拆分和远程调用")]),s._v(" "),e("p",[s._v("任何分布式架构都离不开服务的拆分，微服务也是一样。")]),s._v(" "),e("h2",{attrs:{id:"_2-1-服务拆分原则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-服务拆分原则"}},[s._v("#")]),s._v(" 2.1.服务拆分原则")]),s._v(" "),e("p",[s._v("这里我总结了微服务拆分时的几个原则：")]),s._v(" "),e("ul",[e("li",[s._v("不同微服务，不要重复开发相同业务")]),s._v(" "),e("li",[s._v("微服务数据独立，不要访问其它微服务的数据库")]),s._v(" "),e("li",[s._v("微服务可以将自己的业务暴露为接口，供其它微服务调用")])]),s._v(" "),e("p",[e("img",{attrs:{src:t(1072),alt:"image-20210713210800950"}})]),s._v(" "),e("h2",{attrs:{id:"_2-2-服务拆分示例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-服务拆分示例"}},[s._v("#")]),s._v(" 2.2.服务拆分示例")]),s._v(" "),e("p",[s._v("以课前资料中的微服务cloud-demo为例，其结构如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1073),alt:"image-20210713211009593"}})]),s._v(" "),e("p",[s._v("cloud-demo：父工程，管理依赖")]),s._v(" "),e("ul",[e("li",[s._v("order-service：订单微服务，负责订单相关业务")]),s._v(" "),e("li",[s._v("user-service：用户微服务，负责用户相关业务")])]),s._v(" "),e("p",[s._v("要求：")]),s._v(" "),e("ul",[e("li",[s._v("订单微服务和用户微服务都必须有各自的数据库，相互独立")]),s._v(" "),e("li",[s._v("订单服务和用户服务都对外暴露Restful的接口")]),s._v(" "),e("li",[s._v("订单服务如果需要查询用户信息，只能调用用户服务的Restful接口，不能查询用户数据库")])]),s._v(" "),e("h3",{attrs:{id:"_2-2-1-导入sql语句"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-导入sql语句"}},[s._v("#")]),s._v(" 2.2.1.导入Sql语句")]),s._v(" "),e("p",[s._v("首先，将课前资料提供的"),e("code",[s._v("cloud-order.sql")]),s._v("和"),e("code",[s._v("cloud-user.sql")]),s._v("导入到mysql中：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1074),alt:"image-20210713211417049"}})]),s._v(" "),e("p",[s._v("cloud-user表中初始数据如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1075),alt:"image-20210713211550169"}})]),s._v(" "),e("p",[s._v("cloud-order表中初始数据如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1076),alt:"image-20210713211657319"}})]),s._v(" "),e("p",[s._v("cloud-order表中持有cloud-user表中的id字段。")]),s._v(" "),e("h3",{attrs:{id:"_2-2-2-导入demo工程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-导入demo工程"}},[s._v("#")]),s._v(" 2.2.2.导入demo工程")]),s._v(" "),e("p",[s._v("用IDEA导入课前资料提供的Demo：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1077),alt:"image-20210713211814094"}})]),s._v(" "),e("p",[s._v("项目结构如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1078),alt:"image-20210713212656887"}})]),s._v(" "),e("p",[s._v("导入后，会在IDEA右下角出现弹窗：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1079),alt:"image-20210713212349272"}})]),s._v(" "),e("p",[s._v("点击弹窗，然后按下图选择：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1080),alt:"image-20210713212336185"}})]),s._v(" "),e("p",[s._v("会出现这样的菜单：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1081),alt:"image-20210713212513324"}})]),s._v(" "),e("p",[s._v("配置下项目使用的JDK：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1082),alt:"image-20210713220736408"}})]),s._v(" "),e("h2",{attrs:{id:"_2-3-实现远程调用案例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-实现远程调用案例"}},[s._v("#")]),s._v(" 2.3.实现远程调用案例")]),s._v(" "),e("p",[s._v("在order-service服务中，有一个根据id查询订单的接口：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1083),alt:"image-20210713212749575"}})]),s._v(" "),e("p",[s._v("根据id查询订单，返回值是Order对象，如图：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1084),alt:"image-20210713212901725"}})]),s._v(" "),e("p",[s._v("其中的user为null")]),s._v(" "),e("p",[s._v("在user-service中有一个根据id查询用户的接口：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1085),alt:"image-20210713213146089"}})]),s._v(" "),e("p",[s._v("查询的结果如图：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1086),alt:"image-20210713213213075"}})]),s._v(" "),e("h3",{attrs:{id:"_2-3-1-案例需求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-案例需求"}},[s._v("#")]),s._v(" 2.3.1.案例需求：")]),s._v(" "),e("p",[s._v("修改order-service中的根据id查询订单业务，要求在查询订单的同时，根据订单中包含的userId查询出用户信息，一起返回。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1087),alt:"image-20210713213312278"}})]),s._v(" "),e("p",[s._v("因此，我们需要在order-service中 向user-service发起一个http的请求，调用http://localhost:8081/user/{userId}这个接口。")]),s._v(" "),e("p",[s._v("大概的步骤是这样的：")]),s._v(" "),e("ul",[e("li",[s._v("注册一个RestTemplate的实例到Spring容器")]),s._v(" "),e("li",[s._v("修改order-service服务中的OrderService类中的queryOrderById方法，根据Order对象中的userId查询User")]),s._v(" "),e("li",[s._v("将查询的User填充到Order对象，一起返回")])]),s._v(" "),e("h3",{attrs:{id:"_2-3-2-注册resttemplate"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-注册resttemplate"}},[s._v("#")]),s._v(" 2.3.2.注册RestTemplate")]),s._v(" "),e("p",[s._v("首先，我们在order-service服务中的OrderApplication启动类中，注册RestTemplate实例：")]),s._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("cn"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itcast"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("order")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token import"}},[e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mybatis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("spring"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotation"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MapperScan")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token import"}},[e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("boot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringApplication")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token import"}},[e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("boot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("autoconfigure"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringBootApplication")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token import"}},[e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotation"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Bean")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token import"}},[e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("web"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RestTemplate")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@MapperScan")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn.itcast.order.mapper"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SpringBootApplication")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderApplication")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringApplication")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderApplication")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" args"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RestTemplate")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("restTemplate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RestTemplate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])]),e("h3",{attrs:{id:"_2-3-3-实现远程调用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-实现远程调用"}},[s._v("#")]),s._v(" 2.3.3.实现远程调用")]),s._v(" "),e("p",[s._v("修改order-service服务中的cn.itcast.order.service包下的OrderService类中的queryOrderById方法：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1088),alt:"image-20210713213959569"}})]),s._v(" "),e("h2",{attrs:{id:"_2-4-提供者与消费者"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-提供者与消费者"}},[s._v("#")]),s._v(" 2.4.提供者与消费者")]),s._v(" "),e("p",[s._v("在服务调用关系中，会有两个不同的角色：")]),s._v(" "),e("p",[e("strong",[s._v("服务提供者")]),s._v("：一次业务中，被其它微服务调用的服务。（提供接口给其它微服务）")]),s._v(" "),e("p",[e("strong",[s._v("服务消费者")]),s._v("：一次业务中，调用其它微服务的服务。（调用其它微服务提供的接口）")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1089),alt:"image-20210713214404481"}})]),s._v(" "),e("p",[s._v("但是，服务提供者与服务消费者的角色并不是绝对的，而是相对于业务而言。")]),s._v(" "),e("p",[s._v("如果服务A调用了服务B，而服务B又调用了服务C，服务B的角色是什么？")]),s._v(" "),e("ul",[e("li",[s._v("对于A调用B的业务而言：A是服务消费者，B是服务提供者")]),s._v(" "),e("li",[s._v("对于B调用C的业务而言：B是服务消费者，C是服务提供者")])]),s._v(" "),e("p",[s._v("因此，服务B既可以是服务提供者，也可以是服务消费者。")]),s._v(" "),e("h1",{attrs:{id:"_3-eureka注册中心"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-eureka注册中心"}},[s._v("#")]),s._v(" 3.Eureka注册中心")]),s._v(" "),e("p",[s._v("假如我们的服务提供者user-service部署了多个实例，如图：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1090),alt:"image-20210713214925388"}})]),s._v(" "),e("p",[s._v("大家思考几个问题：")]),s._v(" "),e("ul",[e("li",[s._v("order-service在发起远程调用的时候，该如何得知user-service实例的ip地址和端口？")]),s._v(" "),e("li",[s._v("有多个user-service实例地址，order-service调用时该如何选择？")]),s._v(" "),e("li",[s._v("order-service如何得知某个user-service实例是否依然健康，是不是已经宕机？")])]),s._v(" "),e("h2",{attrs:{id:"_3-1-eureka的结构和作用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-eureka的结构和作用"}},[s._v("#")]),s._v(" 3.1.Eureka的结构和作用")]),s._v(" "),e("p",[s._v("这些问题都需要利用SpringCloud中的注册中心来解决，其中最广为人知的注册中心就是Eureka，其结构如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1091),alt:"image-20210713220104956"}})]),s._v(" "),e("p",[s._v("回答之前的各个问题。")]),s._v(" "),e("p",[s._v("问题1：order-service如何得知user-service实例地址？")]),s._v(" "),e("p",[s._v("获取地址信息的流程如下：")]),s._v(" "),e("ul",[e("li",[s._v("user-service服务实例启动后，将自己的信息注册到eureka-server（Eureka服务端）。这个叫服务注册")]),s._v(" "),e("li",[s._v("eureka-server保存服务名称到服务实例地址列表的映射关系")]),s._v(" "),e("li",[s._v("order-service根据服务名称，拉取实例地址列表。这个叫服务发现或服务拉取")])]),s._v(" "),e("p",[s._v("问题2：order-service如何从多个user-service实例中选择具体的实例？")]),s._v(" "),e("ul",[e("li",[s._v("order-service从实例列表中利用负载均衡算法选中一个实例地址")]),s._v(" "),e("li",[s._v("向该实例地址发起远程调用")])]),s._v(" "),e("p",[s._v("问题3：order-service如何得知某个user-service实例是否依然健康，是不是已经宕机？")]),s._v(" "),e("ul",[e("li",[s._v("user-service会每隔一段时间（默认30秒）向eureka-server发起请求，报告自己状态，称为心跳")]),s._v(" "),e("li",[s._v("当超过一定时间没有发送心跳时，eureka-server会认为微服务实例故障，将该实例从服务列表中剔除")]),s._v(" "),e("li",[s._v("order-service拉取服务时，就能将故障实例排除了")])]),s._v(" "),e("blockquote",[e("p",[s._v("注意：一个微服务，既可以是服务提供者，又可以是服务消费者，因此eureka将服务注册、服务发现等功能统一封装到了eureka-client端")])]),s._v(" "),e("p",[s._v("因此，接下来我们动手实践的步骤包括：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1092),alt:"image-20210713220509769"}})]),s._v(" "),e("h2",{attrs:{id:"_3-2-搭建eureka-server"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-搭建eureka-server"}},[s._v("#")]),s._v(" 3.2.搭建eureka-server")]),s._v(" "),e("p",[s._v("首先大家注册中心服务端：eureka-server，这必须是一个独立的微服务")]),s._v(" "),e("h3",{attrs:{id:"_3-2-1-创建eureka-server服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-创建eureka-server服务"}},[s._v("#")]),s._v(" 3.2.1.创建eureka-server服务")]),s._v(" "),e("p",[s._v("在cloud-demo父工程下，创建一个子模块：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1093),alt:"image-20210713220605881"}})]),s._v(" "),e("p",[s._v("填写模块信息：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1094),alt:"image-20210713220857396"}})]),s._v(" "),e("p",[s._v("然后填写服务信息：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1095),alt:"image-20210713221339022"}})]),s._v(" "),e("h3",{attrs:{id:"_3-2-2-引入eureka依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-引入eureka依赖"}},[s._v("#")]),s._v(" 3.2.2.引入eureka依赖")]),s._v(" "),e("p",[s._v("引入SpringCloud为eureka提供的starter依赖：")]),s._v(" "),e("div",{staticClass:"language-xml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-xml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.cloud"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-cloud-starter-netflix-eureka-server"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"_3-2-3-编写启动类"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-编写启动类"}},[s._v("#")]),s._v(" 3.2.3.编写启动类")]),s._v(" "),e("p",[s._v("给eureka-server服务编写一个启动类，一定要添加一个@EnableEurekaServer注解，开启eureka的注册中心功能：")]),s._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("cn"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itcast"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("eureka")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token import"}},[e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("boot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringApplication")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token import"}},[e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("boot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("autoconfigure"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringBootApplication")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token import"}},[e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cloud"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("netflix"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("eureka"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("server"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EnableEurekaServer")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SpringBootApplication")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@EnableEurekaServer")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EurekaApplication")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringApplication")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EurekaApplication")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" args"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("h3",{attrs:{id:"_3-2-4-编写配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-编写配置文件"}},[s._v("#")]),s._v(" 3.2.4.编写配置文件")]),s._v(" "),e("p",[s._v("编写一个application.yml文件，内容如下：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10086")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("application")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" eureka"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("eureka")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("client")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service-url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("defaultZone")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//127.0.0.1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("10086/eureka\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h3",{attrs:{id:"_3-2-5-启动服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-5-启动服务"}},[s._v("#")]),s._v(" 3.2.5.启动服务")]),s._v(" "),e("p",[s._v("启动微服务，然后在浏览器访问：http://127.0.0.1:10086")]),s._v(" "),e("p",[s._v("看到下面结果应该是成功了：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1096),alt:"image-20210713222157190"}})]),s._v(" "),e("h2",{attrs:{id:"_3-3-服务注册"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-服务注册"}},[s._v("#")]),s._v(" 3.3.服务注册")]),s._v(" "),e("p",[s._v("下面，我们将user-service注册到eureka-server中去。")]),s._v(" "),e("h3",{attrs:{id:"_1-引入依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-引入依赖"}},[s._v("#")]),s._v(" 1）引入依赖")]),s._v(" "),e("p",[s._v("在user-service的pom文件中，引入下面的eureka-client依赖：")]),s._v(" "),e("div",{staticClass:"language-xml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-xml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.cloud"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-cloud-starter-netflix-eureka-client"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"_2-配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件"}},[s._v("#")]),s._v(" 2）配置文件")]),s._v(" "),e("p",[s._v("在user-service中，修改application.yml文件，添加服务名称、eureka地址：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("application")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" userservice\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("eureka")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("client")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service-url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("defaultZone")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//127.0.0.1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("10086/eureka\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"_3-启动多个user-service实例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动多个user-service实例"}},[s._v("#")]),s._v(" 3）启动多个user-service实例")]),s._v(" "),e("p",[s._v("为了演示一个服务有多个实例的场景，我们添加一个SpringBoot的启动配置，再启动一个user-service。")]),s._v(" "),e("p",[s._v("首先，复制原来的user-service启动配置：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1097),alt:"image-20210713222656562"}})]),s._v(" "),e("p",[s._v("然后，在弹出的窗口中，填写信息：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1098),alt:"image-20210713222757702"}})]),s._v(" "),e("p",[s._v("现在，SpringBoot窗口会出现两个user-service启动配置：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1099),alt:"image-20210713222841951"}})]),s._v(" "),e("p",[s._v("不过，第一个是8081端口，第二个是8082端口。")]),s._v(" "),e("p",[s._v("启动两个user-service实例：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1100),alt:"image-20210713223041491"}})]),s._v(" "),e("p",[s._v("查看eureka-server管理页面：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1101),alt:"image-20210713223150650"}})]),s._v(" "),e("h2",{attrs:{id:"_3-4-服务发现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-服务发现"}},[s._v("#")]),s._v(" 3.4.服务发现")]),s._v(" "),e("p",[s._v("下面，我们将order-service的逻辑修改：向eureka-server拉取user-service的信息，实现服务发现。")]),s._v(" "),e("h3",{attrs:{id:"_1-引入依赖-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-引入依赖-2"}},[s._v("#")]),s._v(" 1）引入依赖")]),s._v(" "),e("p",[s._v("之前说过，服务发现、服务注册统一都封装在eureka-client依赖，因此这一步与服务注册时一致。")]),s._v(" "),e("p",[s._v("在order-service的pom文件中，引入下面的eureka-client依赖：")]),s._v(" "),e("div",{staticClass:"language-xml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-xml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.cloud"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-cloud-starter-netflix-eureka-client"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"_2-配置文件-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件-2"}},[s._v("#")]),s._v(" 2）配置文件")]),s._v(" "),e("p",[s._v("服务发现也需要知道eureka地址，因此第二步与服务注册一致，都是配置eureka信息：")]),s._v(" "),e("p",[s._v("在order-service中，修改application.yml文件，添加服务名称、eureka地址：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("application")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" orderservice\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("eureka")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("client")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service-url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("defaultZone")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//127.0.0.1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("10086/eureka\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"_3-服务拉取和负载均衡"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-服务拉取和负载均衡"}},[s._v("#")]),s._v(" 3）服务拉取和负载均衡")]),s._v(" "),e("p",[s._v("最后，我们要去eureka-server中拉取user-service服务的实例列表，并且实现负载均衡。")]),s._v(" "),e("p",[s._v("不过这些动作不用我们去做，只需要添加一些注解即可。")]),s._v(" "),e("p",[s._v("在order-service的OrderApplication中，给RestTemplate这个Bean添加一个@LoadBalanced注解：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1102),alt:"image-20210713224049419"}})]),s._v(" "),e("p",[s._v("修改order-service服务中的cn.itcast.order.service包下的OrderService类中的queryOrderById方法。修改访问的url路径，用服务名代替ip、端口：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1103),alt:"image-20210713224245731"}})]),s._v(" "),e("p",[s._v("spring会自动帮助我们从eureka-server端，根据userservice这个服务名称，获取实例列表，而后完成负载均衡。")]),s._v(" "),e("h1",{attrs:{id:"_4-ribbon负载均衡"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-ribbon负载均衡"}},[s._v("#")]),s._v(" 4.Ribbon负载均衡")]),s._v(" "),e("p",[s._v("上一节中，我们添加了@LoadBalanced注解，即可实现负载均衡功能，这是什么原理呢？")]),s._v(" "),e("h2",{attrs:{id:"_4-1-负载均衡原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-负载均衡原理"}},[s._v("#")]),s._v(" 4.1.负载均衡原理")]),s._v(" "),e("p",[s._v("SpringCloud底层其实是利用了一个名为Ribbon的组件，来实现负载均衡功能的。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1104),alt:"image-20210713224517686"}})]),s._v(" "),e("p",[s._v("那么我们发出的请求明明是http://userservice/user/1，怎么变成了http://localhost:8081的呢？")]),s._v(" "),e("h2",{attrs:{id:"_4-2-源码跟踪"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-源码跟踪"}},[s._v("#")]),s._v(" 4.2.源码跟踪")]),s._v(" "),e("p",[s._v("为什么我们只输入了service名称就可以访问了呢？之前还要获取ip和端口。")]),s._v(" "),e("p",[s._v("显然有人帮我们根据service名称，获取到了服务实例的ip和端口。它就是"),e("code",[s._v("LoadBalancerInterceptor")]),s._v("，这个类会在对RestTemplate的请求进行拦截，然后从Eureka根据服务id获取服务列表，随后利用负载均衡算法得到真实的服务地址信息，替换服务id。")]),s._v(" "),e("p",[s._v("我们进行源码跟踪：")]),s._v(" "),e("h3",{attrs:{id:"_1-loadbalancerintercepor"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-loadbalancerintercepor"}},[s._v("#")]),s._v(" 1）LoadBalancerIntercepor")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1105),alt:"1525620483637"}})]),s._v(" "),e("p",[s._v("可以看到这里的intercept方法，拦截了用户的HttpRequest请求，然后做了几件事：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("request.getURI()")]),s._v("：获取请求uri，本例中就是 http://user-service/user/8")]),s._v(" "),e("li",[e("code",[s._v("originalUri.getHost()")]),s._v("：获取uri路径的主机名，其实就是服务id，"),e("code",[s._v("user-service")])]),s._v(" "),e("li",[e("code",[s._v("this.loadBalancer.execute()")]),s._v("：处理服务id，和用户请求。")])]),s._v(" "),e("p",[s._v("这里的"),e("code",[s._v("this.loadBalancer")]),s._v("是"),e("code",[s._v("LoadBalancerClient")]),s._v("类型，我们继续跟入。")]),s._v(" "),e("h3",{attrs:{id:"_2-loadbalancerclient"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-loadbalancerclient"}},[s._v("#")]),s._v(" 2）LoadBalancerClient")]),s._v(" "),e("p",[s._v("继续跟入execute方法：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1106),alt:"1525620787090"}})]),s._v(" "),e("p",[s._v("代码是这样的：")]),s._v(" "),e("ul",[e("li",[s._v("getLoadBalancer(serviceId)：根据服务id获取ILoadBalancer，而ILoadBalancer会拿着服务id去eureka中获取服务列表并保存起来。")]),s._v(" "),e("li",[s._v("getServer(loadBalancer)：利用内置的负载均衡算法，从服务列表中选择一个。本例中，可以看到获取了8082端口的服务")])]),s._v(" "),e("p",[s._v("放行后，再次访问并跟踪，发现获取的是8081：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(375),alt:"1525620835911"}})]),s._v(" "),e("p",[s._v("果然实现了负载均衡。")]),s._v(" "),e("h3",{attrs:{id:"_3-负载均衡策略irule"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-负载均衡策略irule"}},[s._v("#")]),s._v(" 3）负载均衡策略IRule")]),s._v(" "),e("p",[s._v("在刚才的代码中，可以看到获取服务使通过一个"),e("code",[s._v("getServer")]),s._v("方法来做负载均衡:")]),s._v(" "),e("p",[e("img",{attrs:{src:t(375),alt:"1525620835911"}})]),s._v(" "),e("p",[s._v("我们继续跟入：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1107),alt:"1544361421671"}})]),s._v(" "),e("p",[s._v("继续跟踪源码chooseServer方法，发现这么一段代码：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1108),alt:"1525622652849"}})]),s._v(" "),e("p",[s._v("我们看看这个rule是谁：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1109),alt:"1525622699666"}})]),s._v(" "),e("p",[s._v("这里的rule默认值是一个"),e("code",[s._v("RoundRobinRule")]),s._v("，看类的介绍：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1110),alt:"1525622754316"}})]),s._v(" "),e("p",[s._v("这不就是轮询的意思嘛。")]),s._v(" "),e("p",[s._v("到这里，整个负载均衡的流程我们就清楚了。")]),s._v(" "),e("h3",{attrs:{id:"_4-总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-总结"}},[s._v("#")]),s._v(" 4）总结")]),s._v(" "),e("p",[s._v("SpringCloudRibbon的底层采用了一个拦截器，拦截了RestTemplate发出的请求，对地址做了修改。用一幅图来总结一下：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1111),alt:"image-20210713224724673"}})]),s._v(" "),e("p",[s._v("基本流程如下：")]),s._v(" "),e("ul",[e("li",[s._v("拦截我们的RestTemplate请求http://userservice/user/1")]),s._v(" "),e("li",[s._v("RibbonLoadBalancerClient会从请求url中获取服务名称，也就是user-service")]),s._v(" "),e("li",[s._v("DynamicServerListLoadBalancer根据user-service到eureka拉取服务列表")]),s._v(" "),e("li",[s._v("eureka返回列表，localhost:8081、localhost:8082")]),s._v(" "),e("li",[s._v("IRule利用内置负载均衡规则，从列表中选择一个，例如localhost:8081")]),s._v(" "),e("li",[s._v("RibbonLoadBalancerClient修改请求地址，用localhost:8081替代userservice，得到http://localhost:8081/user/1，发起真实请求")])]),s._v(" "),e("h2",{attrs:{id:"_4-3-负载均衡策略"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-负载均衡策略"}},[s._v("#")]),s._v(" 4.3.负载均衡策略")]),s._v(" "),e("h3",{attrs:{id:"_4-3-1-负载均衡策略"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-负载均衡策略"}},[s._v("#")]),s._v(" 4.3.1.负载均衡策略")]),s._v(" "),e("p",[s._v("负载均衡的规则都定义在IRule接口中，而IRule有很多不同的实现类：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1112),alt:"image-20210713225653000"}})]),s._v(" "),e("p",[s._v("不同规则的含义如下：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[e("strong",[s._v("内置负载均衡规则类")])]),s._v(" "),e("th",[e("strong",[s._v("规则描述")])])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("RoundRobinRule")]),s._v(" "),e("td",[s._v("简单轮询服务列表来选择服务器。它是Ribbon默认的负载均衡规则。")])]),s._v(" "),e("tr",[e("td",[s._v("AvailabilityFilteringRule")]),s._v(" "),e("td",[s._v("对以下两种服务器进行忽略：   （1）在默认情况下，这台服务器如果3次连接失败，这台服务器就会被设置为“短路”状态。短路状态将持续30秒，如果再次连接失败，短路的持续时间就会几何级地增加。  （2）并发数过高的服务器。如果一个服务器的并发连接数过高，配置了AvailabilityFilteringRule规则的客户端也会将其忽略。并发连接数的上限，可以由客户端的  < clientName >.< clientConfigNameSpace >.ActiveConnectionsLimit属性进行配置。")])]),s._v(" "),e("tr",[e("td",[s._v("WeightedResponseTimeRule")]),s._v(" "),e("td",[s._v("为每一个服务器赋予一个权重值。服务器响应时间越长，这个服务器的权重就越小。这个规则会随机选择服务器，这个权重值会影响服务器的选择。")])]),s._v(" "),e("tr",[e("td",[e("strong",[s._v("ZoneAvoidanceRule")])]),s._v(" "),e("td",[s._v("以区域可用的服务器为基础进行服务器的选择。使用Zone对服务器进行分类，这个Zone可以理解为一个机房、一个机架等。而后再对Zone内的多个服务做轮询。")])]),s._v(" "),e("tr",[e("td",[s._v("BestAvailableRule")]),s._v(" "),e("td",[s._v("忽略那些短路的服务器，并选择并发数较低的服务器。")])]),s._v(" "),e("tr",[e("td",[s._v("RandomRule")]),s._v(" "),e("td",[s._v("随机选择一个可用的服务器。")])]),s._v(" "),e("tr",[e("td",[s._v("RetryRule")]),s._v(" "),e("td",[s._v("重试机制的选择逻辑")])])])]),s._v(" "),e("p",[s._v("默认的实现就是ZoneAvoidanceRule，是一种轮询方案")]),s._v(" "),e("h3",{attrs:{id:"_4-3-2-自定义负载均衡策略"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-2-自定义负载均衡策略"}},[s._v("#")]),s._v(" 4.3.2.自定义负载均衡策略")]),s._v(" "),e("p",[s._v("通过定义IRule实现可以修改负载均衡规则，有两种方式：")]),s._v(" "),e("ol",[e("li",[s._v("代码方式：在order-service中的OrderApplication类中，定义一个新的IRule：")])]),s._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IRule")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("randomRule")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RandomRule")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("配置文件方式：在order-service的application.yml文件中，添加新的配置也可以修改规则：")])]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("userservice")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给某个微服务配置负载均衡规则，这里是userservice服务")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ribbon")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("NFLoadBalancerRuleClassName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" com.netflix.loadbalancer.RandomRule "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 负载均衡规则 ")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("blockquote",[e("p",[e("strong",[s._v("注意")]),s._v("，一般用默认的负载均衡规则，不做修改。")]),s._v(" "),e("p",[s._v("优先级：全局配置 > 局部配置")])]),s._v(" "),e("h2",{attrs:{id:"_4-4-饥饿加载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-饥饿加载"}},[s._v("#")]),s._v(" 4.4.饥饿加载")]),s._v(" "),e("p",[s._v("Ribbon默认是采用懒加载，即第一次访问时才会去创建LoadBalanceClient，请求时间会很长。")]),s._v(" "),e("p",[s._v("而饥饿加载则会在项目启动时创建，降低第一次访问的耗时，通过下面配置开启饥饿加载：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ribbon")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("eager-load")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clients")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" userservice\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h1",{attrs:{id:"_5-nacos注册中心"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-nacos注册中心"}},[s._v("#")]),s._v(" 5.Nacos注册中心")]),s._v(" "),e("p",[s._v("国内公司一般都推崇阿里巴巴的技术，比如注册中心，SpringCloudAlibaba也推出了一个名为Nacos的注册中心。")]),s._v(" "),e("h2",{attrs:{id:"_5-1-认识和安装nacos"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-认识和安装nacos"}},[s._v("#")]),s._v(" 5.1.认识和安装Nacos")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://nacos.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nacos"),e("OutboundLink")],1),s._v("是阿里巴巴的产品，现在是"),e("a",{attrs:{href:"https://spring.io/projects/spring-cloud",target:"_blank",rel:"noopener noreferrer"}},[s._v("SpringCloud"),e("OutboundLink")],1),s._v("中的一个组件。相比"),e("a",{attrs:{href:"https://github.com/Netflix/eureka",target:"_blank",rel:"noopener noreferrer"}},[s._v("Eureka"),e("OutboundLink")],1),s._v("功能更加丰富，在国内受欢迎程度较高。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1113),alt:"image-20210713230444308"}})]),s._v(" "),e("p",[s._v("安装方式可以参考课前资料《Nacos安装指南.md》")]),s._v(" "),e("h2",{attrs:{id:"_5-2-服务注册到nacos"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-服务注册到nacos"}},[s._v("#")]),s._v(" 5.2.服务注册到nacos")]),s._v(" "),e("p",[s._v("Nacos是SpringCloudAlibaba的组件，而SpringCloudAlibaba也遵循SpringCloud中定义的服务注册、服务发现规范。因此使用Nacos和使用Eureka对于微服务来说，并没有太大区别。")]),s._v(" "),e("p",[s._v("主要差异在于：")]),s._v(" "),e("ul",[e("li",[s._v("依赖不同")]),s._v(" "),e("li",[s._v("服务地址不同")])]),s._v(" "),e("h3",{attrs:{id:"_1-引入依赖-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-引入依赖-3"}},[s._v("#")]),s._v(" 1）引入依赖")]),s._v(" "),e("p",[s._v("在cloud-demo父工程的pom文件中的"),e("code",[s._v("<dependencyManagement>")]),s._v("中引入SpringCloudAlibaba的依赖：")]),s._v(" "),e("div",{staticClass:"language-xml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-xml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("com.alibaba.cloud"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-cloud-alibaba-dependencies"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("2.2.6.RELEASE"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("pom"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("scope")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("import"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("scope")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("然后在user-service和order-service中的pom文件中引入nacos-discovery依赖：")]),s._v(" "),e("div",{staticClass:"language-xml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-xml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("com.alibaba.cloud"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-cloud-starter-alibaba-nacos-discovery"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("blockquote",[e("p",[e("strong",[s._v("注意")]),s._v("：不要忘了注释掉eureka的依赖。")])]),s._v(" "),e("h3",{attrs:{id:"_2-配置nacos地址"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置nacos地址"}},[s._v("#")]),s._v(" 2）配置nacos地址")]),s._v(" "),e("p",[s._v("在user-service和order-service的application.yml中添加nacos地址：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nacos")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server-addr")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" localhost"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("blockquote",[e("p",[e("strong",[s._v("注意")]),s._v("：不要忘了注释掉eureka的地址")])]),s._v(" "),e("h3",{attrs:{id:"_3-重启"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-重启"}},[s._v("#")]),s._v(" 3）重启")]),s._v(" "),e("p",[s._v("重启微服务后，登录nacos管理页面，可以看到微服务信息：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1114),alt:"image-20210713231439607"}})]),s._v(" "),e("h2",{attrs:{id:"_5-3-服务分级存储模型"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-服务分级存储模型"}},[s._v("#")]),s._v(" 5.3.服务分级存储模型")]),s._v(" "),e("p",[s._v("一个"),e("strong",[s._v("服务")]),s._v("可以有多个"),e("strong",[s._v("实例")]),s._v("，例如我们的user-service，可以有:")]),s._v(" "),e("ul",[e("li",[s._v("127.0.0.1:8081")]),s._v(" "),e("li",[s._v("127.0.0.1:8082")]),s._v(" "),e("li",[s._v("127.0.0.1:8083")])]),s._v(" "),e("p",[s._v("假如这些实例分布于全国各地的不同机房，例如：")]),s._v(" "),e("ul",[e("li",[s._v("127.0.0.1:8081，在上海机房")]),s._v(" "),e("li",[s._v("127.0.0.1:8082，在上海机房")]),s._v(" "),e("li",[s._v("127.0.0.1:8083，在杭州机房")])]),s._v(" "),e("p",[s._v("Nacos就将同一机房内的实例 划分为一个"),e("strong",[s._v("集群")]),s._v("。")]),s._v(" "),e("p",[s._v("也就是说，user-service是服务，一个服务可以包含多个集群，如杭州、上海，每个集群下可以有多个实例，形成分级模型，如图：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1115),alt:"image-20210713232522531"}})]),s._v(" "),e("p",[s._v("微服务互相访问时，应该尽可能访问同集群实例，因为本地访问速度更快。当本集群内不可用时，才访问其它集群。例如：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1116),alt:"image-20210713232658928"}})]),s._v(" "),e("p",[s._v("杭州机房内的order-service应该优先访问同机房的user-service。")]),s._v(" "),e("h3",{attrs:{id:"_5-3-1-给user-service配置集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-1-给user-service配置集群"}},[s._v("#")]),s._v(" 5.3.1.给user-service配置集群")]),s._v(" "),e("p",[s._v("修改user-service的application.yml文件，添加集群配置：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nacos")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server-addr")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" localhost"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster-name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HZ "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群名称")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("重启两个user-service实例后，我们可以在nacos控制台看到下面结果：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1117),alt:"image-20210713232916215"}})]),s._v(" "),e("p",[s._v("我们再次复制一个user-service启动配置，添加属性：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Dserver.port")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8083")]),s._v(" -Dspring.cloud.nacos.discovery.cluster-name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SH\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("配置如图所示：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1118),alt:"image-20210713233528982"}})]),s._v(" "),e("p",[s._v("启动UserApplication3后再次查看nacos控制台：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1119),alt:"image-20210713233727923"}})]),s._v(" "),e("h3",{attrs:{id:"_5-3-2-同集群优先的负载均衡"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-2-同集群优先的负载均衡"}},[s._v("#")]),s._v(" 5.3.2.同集群优先的负载均衡")]),s._v(" "),e("p",[s._v("默认的"),e("code",[s._v("ZoneAvoidanceRule")]),s._v("并不能实现根据同集群优先来实现负载均衡。")]),s._v(" "),e("p",[s._v("因此Nacos中提供了一个"),e("code",[s._v("NacosRule")]),s._v("的实现，可以优先从同集群中挑选实例。")]),s._v(" "),e("p",[s._v("1）给order-service配置集群信息")]),s._v(" "),e("p",[s._v("修改order-service的application.yml文件，添加集群配置：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("spring:\n  cloud:\n    nacos:\n      server-addr: localhost:8848\n      discovery:\n        cluster-name: HZ "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群名称")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("2）修改负载均衡规则")]),s._v(" "),e("p",[s._v("修改order-service的application.yml文件，修改负载均衡规则：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("userservice")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ribbon")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("NFLoadBalancerRuleClassName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" com.alibaba.cloud.nacos.ribbon.NacosRule "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 负载均衡规则 ")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"_5-4-权重配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-权重配置"}},[s._v("#")]),s._v(" 5.4.权重配置")]),s._v(" "),e("p",[s._v("实际部署中会出现这样的场景：")]),s._v(" "),e("p",[s._v("服务器设备性能有差异，部分实例所在机器性能较好，另一些较差，我们希望性能好的机器承担更多的用户请求。")]),s._v(" "),e("p",[s._v("但默认情况下NacosRule是同集群内随机挑选，不会考虑机器的性能问题。")]),s._v(" "),e("p",[s._v("因此，Nacos提供了权重配置来控制访问频率，权重越大则访问频率越高。")]),s._v(" "),e("p",[s._v("在nacos控制台，找到user-service的实例列表，点击编辑，即可修改权重：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1120),alt:"image-20210713235133225"}})]),s._v(" "),e("p",[s._v("在弹出的编辑窗口，修改权重：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1121),alt:"image-20210713235235219"}})]),s._v(" "),e("blockquote",[e("p",[e("strong",[s._v("注意")]),s._v("：如果权重修改为0，则该实例永远不会被访问")])]),s._v(" "),e("h2",{attrs:{id:"_5-5-环境隔离"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-环境隔离"}},[s._v("#")]),s._v(" 5.5.环境隔离")]),s._v(" "),e("p",[s._v("Nacos提供了namespace来实现环境隔离功能。")]),s._v(" "),e("ul",[e("li",[s._v("nacos中可以有多个namespace")]),s._v(" "),e("li",[s._v("namespace下可以有group、service等")]),s._v(" "),e("li",[s._v("不同namespace之间相互隔离，例如不同namespace的服务互相不可见")])]),s._v(" "),e("p",[e("img",{attrs:{src:t(1122),alt:"image-20210714000101516"}})]),s._v(" "),e("h3",{attrs:{id:"_5-5-1-创建namespace"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-1-创建namespace"}},[s._v("#")]),s._v(" 5.5.1.创建namespace")]),s._v(" "),e("p",[s._v("默认情况下，所有service、data、group都在同一个namespace，名为public：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1123),alt:"image-20210714000414781"}})]),s._v(" "),e("p",[s._v("我们可以点击页面新增按钮，添加一个namespace：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1124),alt:"image-20210714000440143"}})]),s._v(" "),e("p",[s._v("然后，填写表单：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1125),alt:"image-20210714000505928"}})]),s._v(" "),e("p",[s._v("就能在页面看到一个新的namespace：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1126),alt:"image-20210714000522913"}})]),s._v(" "),e("h3",{attrs:{id:"_5-5-2-给微服务配置namespace"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-2-给微服务配置namespace"}},[s._v("#")]),s._v(" 5.5.2.给微服务配置namespace")]),s._v(" "),e("p",[s._v("给微服务配置namespace只能通过修改配置来实现。")]),s._v(" "),e("p",[s._v("例如，修改order-service的application.yml文件：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nacos")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server-addr")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" localhost"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster-name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HZ\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 492a7d5d"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("237b"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("46a1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("a99a"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fa8e98e4b0f9 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 命名空间，填ID")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("重启order-service后，访问控制台，可以看到下面的结果：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1127),alt:"image-20210714000830703"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(1128),alt:"image-20210714000837140"}})]),s._v(" "),e("p",[s._v("此时访问order-service，因为namespace不同，会导致找不到userservice，控制台会报错：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1129),alt:"image-20210714000941256"}})]),s._v(" "),e("h2",{attrs:{id:"_5-6-nacos与eureka的区别"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-6-nacos与eureka的区别"}},[s._v("#")]),s._v(" 5.6.Nacos与Eureka的区别")]),s._v(" "),e("p",[s._v("Nacos的服务实例分为两种l类型：")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("临时实例：如果实例宕机超过一定时间，会从服务列表剔除，默认的类型。")])]),s._v(" "),e("li",[e("p",[s._v("非临时实例：如果实例宕机，不会从服务列表剔除，也可以叫永久实例。")])])]),s._v(" "),e("p",[s._v("配置一个服务实例为永久实例：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nacos")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ephemeral")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置为非临时实例")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("Nacos和Eureka整体结构类似，服务注册、服务拉取、心跳等待，但是也存在一些差异：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1130),alt:"image-20210714001728017"}})]),s._v(" "),e("ul",[e("li",[e("p",[s._v("Nacos与eureka的共同点")]),s._v(" "),e("ul",[e("li",[s._v("都支持服务注册和服务拉取")]),s._v(" "),e("li",[s._v("都支持服务提供者心跳方式做健康检测")])])]),s._v(" "),e("li",[e("p",[s._v("Nacos与Eureka的区别")]),s._v(" "),e("ul",[e("li",[s._v("Nacos支持服务端主动检测提供者状态：临时实例采用心跳模式，非临时实例采用主动检测模式")]),s._v(" "),e("li",[s._v("临时实例心跳不正常会被剔除，非临时实例则不会被剔除")]),s._v(" "),e("li",[s._v("Nacos支持服务列表变更的消息推送模式，服务列表更新更及时")]),s._v(" "),e("li",[s._v("Nacos集群默认采用AP方式，当集群中存在非临时实例时，采用CP模式；Eureka采用AP方式")])])])])])}),[],!1,null,null,null);a.default=n.exports},375:function(s,a,t){s.exports=t.p+"assets/img/1525620835911.f36ce91f.png"}}]);